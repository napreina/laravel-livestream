function getStyle(t,e){return t.currentStyle?t.currentStyle[e]:getComputedStyle(t)[e]}!function(){for(var t=0,e=["webkit","moz"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var i=(new Date).getTime(),a=Math.max(0,16.7-(i-t)),n=window.setTimeout(function(){e(i+a)},a);return t=i+a,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var requestAnimFrame=requestAnimationFrame,gift={};gift.support=function(){return!!document.createElement("canvas").getContext&&!!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame)}(),gift.list={},gift._getBinaryContent=function(){function t(){try{return new window.XMLHttpRequest}catch(t){}}function e(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}var i={};i._getBinaryFromXHR=function(t){return t.response||t.responseText};var a=window.ActiveXObject?function(){return t()||e()}:t;return i.getBinaryContent=function(t,e){try{var n=a();n.open("GET",t,!0),"responseType"in n&&(n.responseType="arraybuffer"),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(){var a,r;if(4===n.readyState)if(200===n.status||0===n.status){a=null,r=null;try{a=i._getBinaryFromXHR(n)}catch(s){r=new Error(s)}e(r,a)}else e(new Error("Ajax error for "+t+" : "+this.status+" "+this.statusText),null)},n.send()}catch(r){e(new Error(r),null)}},i.getBinaryContent}(),gift.preload=function(t,e){var i=t.fileurl;if(!gift.list[i]){var a=gift.list[i]={};a.name=t.name,a.animationtime=t.animationtime,a.images=[],a.afterload=[],gift._getBinaryContent(t.fileurl,function(t,n){if(t)return gift.list[i]=null,void e(t);var r=new JSZip;r.loadAsync(n).then(function(t){var e=t.file(/^[0-9]{1,}.png$/),n=[];e.sort(function(t,e){return parseInt(t.name)-parseInt(e.name)});for(var r=0,s=e.length;s>r;r++)n.push(e[r].async("base64").then(function(t){return t}));return JSZip.external.Promise.all(n).then(function(t){for(var e=0;e<t.length;e++){var i=new Image;i.src="data:image/png;base64,"+t[e],a.images[e]=i}do a.afterload.shift();while(a.afterload.length)},function(){gift.list[i]=null,t=null})}).then(function(){r=null},function(t){gift.list[i]=null,r=null,e(t)})})}},gift.canvaszip=function(t){function e(t){if(f||(f=t),u=Math.floor((t-f)/h),l>u){var i=m[u];s.clearRect(0,0,a.width,a.height),s.drawImage(i,0,0,g,c,0,0,a.width,a.height)}u>=l?(s.clearRect(0,0,a.width,a.height),n()):requestAnimFrame(e)}function i(){("function"!=typeof t.ready||t.ready())&&(o=t.animationtime,l=gift.list[zipurl].images.length,h=o/l,m=gift.list[zipurl].images,g=m[0].width,c=m[0].height,a.width=g,a.height=c,requestAnimFrame(e))}var a=t.canvas,n=t.callback||function(){},r=zipurl=t.zipurl;a.hasrun&&cancelAnimationFrame(a.hasrun);var s=a.getContext("2d");if(!s)return n(new Error("your browser don't support canvas")),!1;var o,l,h,g,c,m,u=0,f=0;if(gift.list[zipurl])return void(gift.list[zipurl].images.length>0?i():gift.list[zipurl].afterload.push(i));var d=gift.list[zipurl]={};d.images=[],d.afterload=[],gift._getBinaryContent(t.zipurl,function(i,s){if(i)return gift.list[zipurl]=null,void n(i);var u=new JSZip;u.loadAsync(s).then(function(t){var e=t.file(/^[0-9]{1,}.png$/),i=[];e.sort(function(t,e){return parseInt(t.name)-parseInt(e.name)});for(var a=0,n=e.length;n>a;a++)i.push(e[a].async("base64").then(function(t){return t}));return JSZip.external.Promise.all(i).then(function(t){for(var e=0;e<t.length;e++){var i=new Image;i.src="data:image/png;base64,"+t[e],d.images[e]=i}do d.afterload.shift();while(d.afterload.length)},function(){gift.list[r]=null,t=null})}).then(function(){if(o=t.animationtime,l=gift.list[r].images.length,!(l>0))throw gift.list[r]=null,new Error("can't find images");h=o/l,m=gift.list[r].images,g=m[0].width,c=m[0].height,a.width=g,a.height=c,requestAnimFrame(e)},function(t){gift.list[r]=null,u=null,n(t)}).then(function(){u=null},function(t){gift.list[r]=null,u=null,n(t)})})},gift.animate=function(t,e,i){var a={};a.canvas=t,a.animationtime=e.animationtime,a.zipurl=e.fileurl,a.callback=i,this.canvaszip(a)},gift.enter=function(){var t={ctx:null,canvas:null,type:null,width:750,height:1334,screenTpy:1};t.animate=function(o,l,h){function g(o){m||(m=o);var l=o-m;if(8e3>=l){switch(t.ctx.clearRect(0,0,t.width,t.height),s.draw(l),n.draw(l),a.draw(l),r.draw(l),t.type){case 1:e.draw(l);break;case 2:i.draw(l)}requestAnimFrame(g)}else t.ctx.clearRect(0,0,t.width,t.height),t.canvas.style.backgroundColor="transparent",h&&h()}function c(t){t.sort(function(t,e){return t=t.name.match(/([0-9]+)\.png/)[1],e=e.name.match(/([0-9]+)\.png/)[1],t=parseInt(t),e=parseInt(e),t-e})}var m;if(!o.getContext("2d"))return void(h&&h(new Error("this is not a canvas element")));t.ctx=o.getContext("2d"),t.canvas=o,t.type=l.type,r.image=new Image,r.ready=!1,r.image.onload=function(){r.ready=!0},r.image.src=l.avatar;var u,f;if(u=getStyle(o,"width"),u=parseInt(u),f=getStyle(o,"height"),f=parseInt(f),u>f&&(t.width=2373,t.screenTpy=2),o.width=t.width,o.height=t.height,o.style.backgroundColor="rgba(0, 0, 0, 0.4)",1==t.load)requestAnimFrame(g);else{var d=-1==location.hostname.indexOf("test1")?"static.yizhibo.com":"static.yizhibo.com";gift._getBinaryContent("//"+d+"/js/libs/gift/zips/enter.zip.js",function(r,s){if(r)return t.load=!1,void(h&&h(r));var o=new JSZip;o.loadAsync(s).then(function(r){var s=r.file(/^mingxing\/[0-9]{1,}.png$/),o=r.file(/^shenhao\/[0-9]{1,}.png$/),l=r.file(/^light\/[0-9]{1,}.png$/),h=r.file(/^back\/[0-9]{1,}.png$/),g=[];c(s),c(o),c(l),c(h);for(var m=0;m<s.length;m++)g.push(s[m].async("base64"));for(var m=0;m<o.length;m++)g.push(o[m].async("base64"));for(var m=0;m<l.length;m++)g.push(l[m].async("base64"));for(var m=0;m<h.length;m++)g.push(h[m].async("base64"));return JSZip.external.Promise.all(g).then(function(t){t=t.map(function(t){var e=new Image;return e.src="data:image/png;base64,"+t,e}),e.images=t.splice(0,s.length),i.images=t.splice(0,o.length),a.images=t.splice(0,l.length),n.images=t.splice(0,h.length)},function(){t.load=!1,r=null})}).then(function(){requestAnimFrame(g)}).then(function(){t.load=!0,o=null},function(e){t.load=!1,o=null,h&&h(e)})})}};var e={images:[],X:125,Y:310,X1:540.6,Y1:156.6,interval:40,draw:function(e){var i=Math.floor(e/this.interval);i>=this.images.length&&(i=this.images.length-1),1==t.screenTpy?t.ctx.drawImage(this.images[i],this.X,this.Y):(t.ctx.save(),t.ctx.scale(1.5,1.5),t.ctx.drawImage(this.images[i],this.X1,this.Y1),t.ctx.restore())}},i={images:[],X:123,Y:308,X1:539,Y1:155,interval:40,draw:function(e){var i=Math.floor(e/this.interval);i>=this.images.length&&(i=this.images.length-1),1==t.screenTpy?t.ctx.drawImage(this.images[i],this.X,this.Y):(t.ctx.save(),t.ctx.scale(1.5,1.5),t.ctx.drawImage(this.images[i],this.X1,this.Y1),t.ctx.restore())}},a={images:[],startTime:2400,interval:100,step:.5233,angle:0,draw:function(e){if(e>this.startTime){var i=parseInt((e-this.startTime)/this.interval);16>i&&(this.angle=15*Math.PI/180*(Math.sin(i*Math.PI/15-Math.PI/2)+1)/2),i>=20&&45>i&&(i-=5,this.angle=15*Math.PI/180*Math.sin(i*Math.PI/30));var a=t.ctx;1==t.screenTpy?(a.save(),a.translate(220,-25),a.scale(2,2),a.rotate(-this.angle),a.drawImage(this.images[0],-220,-25),a.restore(),a.save(),a.translate(530,-25),a.scale(2,2),a.rotate(this.angle),a.drawImage(this.images[1],-530,-25),a.restore()):(a.save(),a.translate(1031,-25),a.scale(2,2),a.rotate(-this.angle),a.drawImage(this.images[0],-220,-25),a.restore(),a.save(),a.translate(1341,-25),a.scale(2,2),a.rotate(this.angle),a.drawImage(this.images[1],-530,-25),a.restore())}}},n={images:[],startTime:2400,interval:100,opacity:1,draw:function(e){if(e>this.startTime){var i=parseInt((e-this.startTime)/this.interval);this.opacity=(Math.cos(i/10*Math.PI)+1)/2;var a=t.ctx;1==t.screenTpy?(a.save(),a.globalAlpha=this.opacity,a.drawImage(this.images[0],0,0),a.globalAlpha=1-this.opacity,a.drawImage(this.images[1],0,0),a.restore()):(a.save(),a.globalAlpha=this.opacity,a.drawImage(this.images[0],50,0),a.drawImage(this.images[1],811,0),a.drawImage(this.images[0],1573,0),a.globalAlpha=1-this.opacity,a.drawImage(this.images[1],100,0),a.drawImage(this.images[0],811,0),a.drawImage(this.images[1],1523,0),a.restore())}}},r={X:285,Y:392,X1:699,Y1:239,r:92,image:"",ready:!1,draw:function(){if(1==this.ready){var e=t.ctx;1==t.screenTpy?(e.save(),e.beginPath(),e.arc(this.X+this.r,this.Y+this.r,this.r,0,2*Math.PI),e.fillStyle="#fff",e.closePath(),e.fill(),e.globalCompositeOperation="source-atop",e.drawImage(this.image,0,0,this.image.width,this.image.height,this.X,this.Y,2*this.r,2*this.r),e.restore()):(e.save(),e.scale(1.5,1.5),e.beginPath(),e.arc(this.X1+this.r,this.Y1+this.r,this.r,0,2*Math.PI),e.fillStyle="#fff",e.closePath(),e.fill(),e.globalCompositeOperation="source-atop",e.drawImage(this.image,0,0,this.image.width,this.image.height,this.X1,this.Y1,2*this.r,2*this.r),e.restore())}}},s={startTime:6960,interval:40,opacity:1,draw:function(e){if(e>this.startTime){var i=parseInt((e-this.startTime)/this.interval);this.opacity=1-i/25}else this.opacity=1;t.canvas.style.opacity=this.opacity}};return t.animate}(),window.canvasgift=gift;