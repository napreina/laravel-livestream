function render(){function e(e){var o=room.pro.online=parseInt(e);o>1e4&&(o=(o/1e4).toFixed(2)+"万"),$(".J_maxonline").html(o+"热度")}function o(e){function o(){var o;o=$("#J_gift_normal>.hide");var r="J_gu_"+e.memberid_+"_"+e.giftid_,i=$(".gift_normal #"+r);if(i.length>0&&!i.is("hide"))i.attr("data-amount",parseInt(i.attr("data-amount"))+1);else if(o.length>0)t(e,1);else{for(var a=0;a<c.length;a++){var n=c[a];if(n.memberid==e.memberid_&&n.giftid==e.giftid_)return void(n.amount=(parseInt(n.amount)+parseInt(e.amount_)).toString())}c.push(e)}}function t(e,o){function i(){$("#J_luxury").fadeOut(100,function(){if($(this).addClass("hide"),l.length>0){var e=l.shift();t(e,2)}})}function a(e){e.c=r(e.amount_,1),e.p=e.amount_.replace(/\d/g,function(o){return'<img src="//static.yizhibo.com/pc_live/static/images/gif/'+e.c+"/"+o+'.png" alt="" class="w16">'}),n.attr("data-current",e.amount_).removeClass().addClass((0==o?"gift":"effect")+" userlevel_"+e.c);var i=(new Date).getTime();n.html(template(1==o?"room/gift/efect_gift_normal":"room/gift/giftx",e)),setTimeout(function(){$(".boom",n).hide()},m),$(".num .w10",n).animate({width:10,height:13},m),$(".num .w16",n).animate({width:16,height:20},m),setTimeout(function(){if((new Date).getTime()-i>6e3){n.attr("id","").addClass("hide");var r=0==o?s:c;return void(r.length>0&&t(r.shift(),o))}var l=parseInt(n.attr("data-amount")),d=parseInt(n.attr("data-current"));l>d?(e.amount_=(d+(l-d>10&&0==o?10:1)).toString(),a(e)):setTimeout(arguments.callee,m)},2*m)}var n;switch(e.giftid=e.giftid_,o){case 2:var d=room.pro.gift["gift"+e.giftid_];if(!d)return void console.log("没找到礼物:"+e.giftid_);if(e.name=d.name,$("#J_luxury").removeClass("hide").html("").hide(),$("#J_luxury").append(_).append(template("room/gift/giftlux",e)).stop().fadeIn(100),canvasgift.support){var u=$("#J_luxury canvas")[0];return u||$("#J_luxury").append("<canvas"+(room.pro.widthvideo?' style = "width:'+parseInt($("#J_w400").height()/640*360)+"px; height:"+$("#J_w400").height()+'px"':"")+"></canvas>"),u=$("#J_luxury canvas")[0],$.extend(e,room.pro.gift["gift"+e.giftid_],{id:e.giftid_},{fileurl:room.pro.gift["gift"+e.giftid_].fileurl+".js"}),void canvasgift.animate(u,e,i)}var _=new Image;return _.onload=function(){setTimeout(i,d.animationtime-200)},_.onerror=i,void(_.src=d.pcurl+"?"+Date.now());case 1:n=$("#J_gift_normal>.hide").eq(0);break;case 0:n=$("#J_continue_gift_1>.hide").eq(0)}n.attr({"data-amount":e.amount_,id:"J_gu_"+e.memberid_+"_"+e.giftid_}),n.removeClass("hide"),e.amount_=1==o?"1":"10",a(e)}function r(e){var o=e;"string"!=typeof e&&(e=e.toString()),"number"!=typeof o&&(o=parseInt(o));for(var t=4,r=4;r>0&&o<d[r-1];)r--,t=r;return t}if(e&&!room.pro.locklive)if("1"==e.isbursts_){var i;if("1"==e.amount_){i=$("#J_gift_normal>.hide");var a="J_gu_"+e.memberid_+"_"+e.giftid_,n=$(".gift_normal #"+a);if(n.length>0&&!n.is("hide"))n.attr("data-amount",parseInt(n.attr("data-amount"))+1);else if(i.length>0)t(e,1);else{for(var u=0;u<c.length;u++){var _=c[u];if(_.memberid==e.memberid_&&_.giftid==e.giftid_)return void(_.amount=(parseInt(_.amount)+parseInt(e.amount_)).toString())}c.push(e)}}else i=$("#J_continue_gift_1 > .hide"),i.length>0?t(e,0):s.push(e)}else if("1"==e.childtype_){var g=room.pro.gift["gift"+e.giftid_];g?g.fileurl?$("#J_luxury").is(".hide")?t(e,2):l.push(e):o():console.log("没找到礼物:"+e.giftid_)}else o()}function t(o){function a(e){var o,t=2e3,r=e.level_,i=e.nobleLevel_||0,a=template("room/msg/welcome",e),n="#J_welcome_1",s=0;i&&i>3?(n="#J_welcome_2",o="noble_bg"+i):r>25?(n="#J_welcome_2",p.lastlogin2&&p.lastlogin2>(new Date).getTime()?(s=p.lastlogin2-(new Date).getTime(),p.lastlogin2+=t):p.lastlogin2=(new Date).getTime()+t,o="welcome_26"):(p.lastlogin&&p.lastlogin>(new Date).getTime()?(s=p.lastlogin-(new Date).getTime(),p.lastlogin+=t):p.lastlogin=(new Date).getTime()+t,o="welcome_25");var c=$(n);setTimeout(function(e,o,t){return function(){$(o).stop().removeClass().addClass(o.replace("#J_","")).addClass(t).html(e).css({left:"100%",opacity:"1"}).show().animate({left:"0"},300)}}(a,n,o),s),setTimeout(function(){c.fadeOut(500)},s+t-500)}function s(e){if(!canvasgift.support)return!1;var o=$("#J_canvas_enter")[0],r=e.avatar_,i={type:2,avatar:r};"明星"==e.ytypename_&&(i.type=1),o||$("#J_cover").append('<canvas id="J_canvas_enter" class="canvas_enter" ></canvas>'),$("#J_enter_effect").html(template("room/msg/enter",e)).stop().show().fadeIn(200),o=$("#J_canvas_enter")[0],$("#J_canvas_enter").css({width:$("#J_w400").width(),height:$("#J_w400").height()}),canvasgift.enter(o,i,function(){document.getElementById("J_enter_effect").style.display="none",t()})}if(o){if("[object Array]"==Object.prototype.toString.call(o)&&(o=o[0]),room.load.load_watcher(o),o.level_=o.level_&&parseInt(o.level_),common.pro.querystring.debuglevel&&(o.level_+=parseInt(common.pro.querystring.debuglevel),o.level_>60&&(o.level_=60)),e(o.online_),o.nobleLevel_=parseInt(o.nobleLevel_),!(o.nobleLevel_&&0!=o.nobleLevel_||f&&f.memberid==o.memberid_)){if(o.level_<room.pro.limit.enter_1)return;if(o.level_==room.pro.limit.enter_1&&room.pro.online&&room.pro.online>5e3)return}g=Date.now(),r();var c=template("room/msg/login",$.extend(o,room.pro.limit));return c==room.pro.alone_watcher.s||(room.pro.alone_watcher.s=c,u.append(c)),i(),o.nobleLevel_>3&&a(o),void(o.level_>49||"明星"==o.ytypename_?0!=n.length||window.__enterefect?n.push(o):(s(o),window.__enterefect=1):o.level_>9&&a(o))}if(0!=n.length){var l=n.shift();s(l)}}function r(){if(!((new Date).getTime()-h<18e4)){var e=new Date;h=e.getTime(),e=e.Format("hh:mm"),$("#J_msglist").append('<div class="msg_3">'+e+"</div>")}}function i(){u.scrollTop(2e4)}function a(){$("#J_gift_his").parent().scrollTop(2e4)}var n=[],s=[],c=[],l=[],m=318,d=[50,100,500,1e3],u=$("#J_msglist"),_=$("#J_gift_his"),g=(_.parent(),0),p=this,f=common.checklogin(),h=0;this.add=function(e){"string"==typeof e&&(e=$.parseJSON(e));var o=common.checklogin();if(o=o||{},o.memberid!=e.memberid_)this.msgrender(e);else if(e.groupName_&&e.groupLevel_){o.group_name=e.groupName_,o.group_level=e.groupLevel_;var t=JSON.stringify(o);localStorage.setItem("ls_login",t)}},this.msgrender=function(e,o){if(310==e.cmdId&&!room.pro.locklive)if(anchor.carouselid){var t={height:$("#J_flash").height(),width:$("#J_flash").width()},a=Math.random()*(t.height-300)+50;e.top=a,e.left=t.width,"number"!=typeof e.level_&&(e.nobleLevel_=parseInt(e.nobleLevel_)),void 0===e.nobleLevel_&&(e.nobleLevel_=parseInt(e.peerage_level)||0);var n=$(template("room/msg/danmu",e));$("#J_cover").append(n),n.animate({left:-400},8e3,"swing",function(){n.remove()})}else{var t={height:$("#J_flash").height(),width:$("#J_flash").width()},a=Math.random()*(t.height-300)+50;e.top=a,e.left=t.width,"number"!=typeof e.level_&&(e.nobleLevel_=parseInt(e.nobleLevel_)),void 0===e.nobleLevel_&&(e.nobleLevel_=parseInt(e.peerage_level)||0);var n=$(template("room/msg/danmu",e));$("#J_cover").append(n),n.animate({left:-400},8e3,"swing",function(){n.remove()})}if(310!=e.cmdId||o){for(var s=$("#J_msglist>div"),c=0;c<s.length-91;c++)s.eq(c).remove();r(),"number"!=typeof e.level_&&(e.level_=parseInt(e.level_)),"number"!=typeof e.nobleLevel_&&(e.nobleLevel_=parseInt(e.nobleLevel_)),void 0===e.nobleLevel_&&(e.nobleLevel_=e.peerage_level||0);var l=template("room/msg/comment",e);u.append(l),i()}},this.login=t,this.message=function(e){"string"==typeof e&&(e=$.parseJSON(e));var o=common.checklogin();switch("string"!=typeof e.type_&&(e.type_=e.type_&&e.type_.toString&&e.type_.toString()||String(e.type_)),e.type_){case"4":var t=template("room/msg/msg_2",e);r(),u.append(t),i();break;case"9":case"10":if(!o)break;r(),u.append('<div class="msg_2">'+e.message+"</div>"),common.getmywallet(room.pro.scid);break;case"5":e.content_.indexOf("送了")>-1&&this.gifthis(e);break;case"14":$("#J_freestar").text(e.count);break;case"15":window.Jiframe_h5corner&&Jiframe_h5corner(e.extra_h5);break;case"37":this.system_message(e)}},this.gift=function(e){"string"==typeof e&&(e=$.parseJSON(e));var o=common.checklogin();o=o||{},room.load.load_siterank(e),o.memberid!=e.memberid_&&this.rendergift(e)},this.rendergift=function(e){if(!(e.type_>0&&e.type_<4||10==e.type_||6==e.animationtype_)){room.render.updateanchorgoldcoins(e.goldcoins_);var t=room.pro.gift["gift"+e.giftid_];if(!t)return void console.log("没找到礼物:"+e.giftid_);if(e.name=t.name,e.cover=t.cover,e.cover_=t.cover,e.fileurl=t.fileurl,e.childtype=t.childtype,e.childtype_=t.childtype,e.goldcoin=t.goldcoin,e.isbursts=t.isbursts,e.isbursts_=t.isbursts,e.subtype=t.subtype,e.subtype_=t.subtype,e.tabtype=t.tabtype,this.giftquery(e),14==e.type_&&this.world_gift(e),room.pro.locklive||o(e),room.pro.anchor.carouselid){{$(".info .J_goldcoin")}$(".info .J_goldcoin").html(e.goldcoins_)}}},this.live_info=function(o){"string"==typeof o&&(o=$.parseJSON(o)),"1"==o.status_&&room.fn.endlive(o),"2"==o.status_&&room.fn.endlive(o),e(o.online_),room.render.updateanchorgoldcoins(o.goldcoins_)},this.gifthis=function(e){var o=new Date;e.time=o.Format("hh:mm"),e.nickname_+=Math.random()>.5?" ":"",e.amount=parseInt(e.content_.replace(/[^0-9]/gi,""));for(var t=template(room.pro.widthvideo?"room/gift/gifthis_widthvideo":"room/gift/gift",e),r=$("#J_gift_his li"),i=0;i<r.length-91;i++)r.eq(i).remove();$("#J_gift_his").append(t),a()},this.giftquery=function(e){if(e.cdtime_||room.pro.gift["gift"+e.giftid_]&&room.pro.gift["gift"+e.giftid_].tabtype&&13==room.pro.gift["gift"+e.giftid_].tabtype){clearInterval(room.pro.usermessage.guardtime);var o=e.cdtime_||room.pro.gift["gift"+e.giftid_].duration;$("#giftpendant").html(template("room/gift/giftpendant",e)),room.pro.usermessage.guardgif={chatmsg:e,giftmsg:room.pro.gift["gift"+e.giftid_],anchorlevel:e.anchorLevel||anchor.level,cdtime:e.cdtime_||room.pro.gift["gift"+e.giftid_].duration},room.pro.usermessage.guardtime=setInterval(function(){o--,1>o&&($("#giftpendant").html(""),clearInterval(room.pro.usermessage.guardtime)),$("#guard_countdown").html(o+"s")},1e3)}},this.world_gift=function(e){e.anchor_name=anchor.nickname,$("#J_cover").append(template("room/gift/world_gift",e)),$(".world_gift").animate({left:"-200%"},1e4,function(){$(this).remove()})},this.system_message=function(e){var o=2500,t=template("room/msg/system_msg",e),r="#system_message",i=$(r);setTimeout(function(e,o){return function(){$(o).stop().html(e).css({left:"100%",opacity:"1"}).show().animate({left:"0"},500)}}(t,r),0),setTimeout(function(){i.fadeOut(500)},o)},this.system_hints=function(){var e="你的浏览器暂不支持评论消息系统，请您升级到最新浏览器。";$("#J_msglist").append('<div class="msg_hints">'+e+"</div>")}}window.room={pro:{url:{getgiftlist:"//pay.yizhibo.com/gift/api/get_gift_list_background",getprop_cards:"/activity/h5api/get_user_prop_cards_info",getroomwatch:"//pay.yizhibo.com/gift/api/get_room_watch_gift_background",get_site_rank:"/gift/h5api/get_single_list",get_all_member:"/live/h5api/get_live_online_members",get_anchor_info:"/live/h5api/get_basic_live_info",get_normal_rank:"/gift/h5api/get_watch_members",praise:"/praise/h5api/add_praise",comment:"/www/live/send_live_comment?p_from=pRoom.Chat",gift:"/gift/h5api/buy_gift_h5?p_from=pRoom.Gift",anchor_status:"/live/h5api/get_live_member_content_list",get_my_wallet:"/member/h5api/get_my_wallet",recommend:"/live/h5api/get_live_over_recom",get_recharge_list:"pay.yizhibo.com/product/api/get_product_list_weibo_background",submit_recharge:"pay.yizhibo.com/inpour/api/create_inpour_order_weibo_background",getmemberinfo:"/member/h5api/get_member_info_for_live",getplalycomment:"/live/h5api/get_playback_event",get_micorder_list:"/carousel/h5api/micorder_list",get_micro_list:"/carousel/h5api/get_rank_list",get_micro_appearance:"/carousel/h5api/micorder_detail_programs",micorder_detail:"/carousel/h5api/micorder_detail",get_basic_live_info:"/live/h5api/get_basic_live_info",get_royal:"/live/h5api/get_royal_box_member"},gift:{},anchor:{},siterank:[],watcher:[],alone_watcher:{},nobler:{bool:!1,list:[],noble_num:0},isCHAT:!0,rem_time:null,mic_current:{sttime:1*new Date},last_memberid:"",locklive:!1,widthvideo:!1,limit:{enter_1:6,enter_2:5,enter_3:21,talk_1:21,roomcount_1:5e3},usermessage:{islayer:!0,settime:null,goldnumner:0,comment:0,guardgif:null,guardtime:null,duration:0}},fn:{testwidthvideo:function(){room.pro.anchor.width=1280,room.pro.anchor.height=720,room.pro.widthvideo=!0,room.load.load_normal_rank(),room.render.widthvideo(),room.fn.resizevideo()},videofn:{curevent:function(){function e(e){console.log(e),null==e&&(e=window.event);var n=e.clientX-r,s=i+n;0>s&&(s=0),s>a&&(s=a);var c=s/a;$(".process .cur",t).css("width",100*c+"%"),o.currentTime=c*o.duration}var o=$("#my_video_1")[0],t=$("#J_contrl");if(t.on("click",".play",function(e){e.preventDefault(),$(this).is(".pause")?($(this).removeClass("pause"),o.pause()):($(this).addClass("pause"),o.play())}),11==anchor.status){t.on("click",".process",function(e){e.preventDefault();var r=e.clientX,i=(r-t.offset().left)/t.width();$(".cur",this).css("width",100*i+"%"),o.currentTime=o.duration*i});var r,i=0,a=$(".process",t).width();$(".process button",t).on("mousedown",function(o){o||(o=window.event),i=$(".process .cur",t).width(),r=o.clientX,document.onmousemove=e}),document.onmouseup=function(){document.onmousemove=null}}},volevent:function(){function e(e){console.log(e),null==e&&(e=window.event);var n=r-e.clientY,s=i+n;0>s&&(s=0),s>a&&(s=a);var c=s/a;$(".vol .cur",t).css("height",100*c+"%"),o.volume=c}var o=$("#my_video_1")[0],t=$("#J_contrl");t.on("click",".vol",function(e){e.preventDefault();var o=$(this);$(".mark",o).css("opacity","1").fadeIn(),setTimeout(function(){$(".mark",o).fadeOut()},6e3)}).on("click",".vol .pro",function(e){e.preventDefault();var r=e.clientY,i=(t.offset().top-r)/$(this).height();$(".cur",this).css("height",100*i+"%"),i>.97&&(i=1),.03>i&&(i=0),o.volume=i});var r,i=0,a=$(".vol .pro",t).height();$(".vol button",t).on("mousedown",function(o){o||(o=window.event),i=$(".vol .cur",t).height(),r=o.clientY,document.onmousemove=e}),document.onmouseup=function(){document.onmousemove=null}}},videojs:function(e){function o(e){return e>6e3?parseInt(e/60)+":"+("0"+parseInt(e)%60).substr(-2):("0"+parseInt(e/60)).substr(-2)+":"+("0"+parseInt(e)%60).substr(-2)}function t(){d>2?(10==anchor.status?a(decodeURIComponent(anchor.play_url)):l.currentTime+=10,d=0,u&&(clearTimeout(u),u=null)):(d++,u&&clearTimeout(u),u=setTimeout(function(){d=0,u=null},9e3))}function r(e){var o="";switch(e.type){case"durationchange":break;case"resize":o=e.target.videoWidth+"/"+e.target.videoHeight;break;case"loadedmetadata":case"loadeddata":case"canplay":case"canplaythrough":case"ended":case"seeking":case"seeked":case"play":case"playing":case"pause":case"waiting":case"stalled":case"error":}}function i(){l&&"currentTime"in l&&(l.paused||(Date.now()/1e3-g-l.currentTime-p>0?p>8?(console.log("now:"+Date.now()/1e3+" dottime:"+g+" currentTime:"+l.currentTime+" times:"+p),10==anchor.status?a(decodeURIComponent(anchor.play_url)):l.currentTime+=5,g=Date.now()/1e3-l.currentTime,p=1):p++:(p=1,g=Date.now()/1e3-l.currentTime),$("#J_contrl .time span").html(o(l.currentTime)),l.currentTime/l.duration-_>.03&&11==anchor.status&&$("#J_contrl .process .cur").css("width",l.currentTime/l.duration*100+"%")))}function a(e){if(!e)return!1;e=e.replace(/^https?:/,""),c&&clearInterval(c),g=Date.now()/1e3,p=1,c=setInterval(i,1e3),s&&(s.destroy(),s.bufferTimer&&(clearInterval(s.bufferTimer),s.bufferTimer=void 0),s=null);({url:e,t0:performance.now(),load:[],buffer:[],video:[],level:[],bitrate:[]});s=new Hls({debug:!1,enableWorker:!0}),s.loadSource(e),s.attachMedia(l),10==anchor.status&&s.on(Hls.Events.FRAG_CHANGED,function(){l.duration>l.currentTime+8&&(l.currentTime=l.duration-5)}),s.on(Hls.Events.ERROR,t)}if(!window.Hls||!Hls.isSupported())return!1;if(e&&$("#my_video_1").length>0)return $("#my_video_1").trigger("uerror"),!0;var n=$("#J_flash").css("margin-left","0");n.html('<video id="my_video_1" class="video-js yizhibo yizhiboh5player" autoplay width="100%" height="100%"></video>');var s,c,l=$("#my_video_1")[0],m='<div class="mark"><div class="process">'+(10==anchor.status?"":'<div class="cur"><button></button></div>')+'</div><div class="time"><span>00:00</span>'+(10==anchor.status?"":"<em>/00:00</em>")+'</div><div class="vol"><div class="mark"><div class="pro"><div class="cur"><button></button></div></div></div></div><button class="play pause"></button></div>';$("#J_contrl .mark").remove(),$("#J_contrl").css({width:"100%","background-color":"rgba(0,0,0,0.6)"}).prepend(m),a(decodeURIComponent(anchor.play_url)),room.fn.videofn.curevent(),room.fn.videofn.volevent(),e||($(l).on("uerror",function(e){e.preventDefault(),10==anchor.status?(a(decodeURIComponent(anchor.play_url)),console.log("videoerror")):v.currentTime+=10}),l.addEventListener("resize",r),l.addEventListener("seeking",r),l.addEventListener("seeked",r),l.addEventListener("pause",r),l.addEventListener("play",r),l.addEventListener("canplay",r),l.addEventListener("canplaythrough",r),l.addEventListener("ended",r),l.addEventListener("playing",r),l.addEventListener("error",function(e){if(10==anchor.status){if(a(decodeURIComponent(anchor.play_url)),console.log("videoerror"),e.cancelable&&e.returnValue&&e.isTrusted)return!0}else v.currentTime+=10}),l.addEventListener("loadedmetadata",r),l.addEventListener("loadeddata",r),l.addEventListener("durationchange",r),l.addEventListener("canplay",function(){room.pro.anchor.width=document.getElementById("my_video_1").videoWidth||room.pro.anchor.width,room.pro.anchor.height=document.getElementById("my_video_1").videoHeight||room.pro.anchor.height,11==anchor.status&&$("#J_contrl .time em").html("/"+o(l.duration)),room.fn.resizevideo()}));var d=0,u=null,_=0,g=Date.now()/1e3,p=1;return!0},extendie:function(){Date.now||(Date.now=function(){return(new Date).getTime()}),Date.prototype.Format=function(e){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var t in o)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?o[t]:("00"+o[t]).substr((""+o[t]).length)));return e}},resizevideo:function(){function e(){for(var e=$("#J_anchor_status"),o=($("#J_anchor_status").width()-50)/78,t=$(".history",e),r=0;r<t.length;r++)o-1>=r?t.eq(r).show():t.eq(r).hide()}var o=document.getElementById("J_live_box");if($(o).animate({opacity:1},200),e(),room.pro.isweibo)return void(window.onresize=null);var t=900,r=540,i=room.pro.anchor.height,a=room.pro.anchor.width,n=document.documentElement,s=n.clientHeight,c=n.clientWidth,l=c>1060?360:300,m=c-340-l-60;if(i>a)s=a/i>m/s&&m/a*i||s,s=s>t&&t||r>s&&r||s,a=s/i*a+340+l+1;else{var d=148;s-=d,t=585,r=394,m=c-l-60,s=a/i>m/s&&m/a*i||s,s=s>t&&t||r>s&&r||s,a=s/i*a+l,document.getElementById("J_w400").style.height=s+"px",900>s+d&&s+d<n.clientHeight&&(d=(n.clientHeight>900?900:n.clientHeight)-s),$(".w330").height(d),250>d?($("#J_anchor_status,#J_anchorinfo").hide(),$(".w400 .anchorinfo").show(),$("#J_maxonline").hide(),$("#J_resize").css("top","0"),$(".mystore").css("top","0")):(setTimeout(e,0),$("#J_anchor_status,#J_anchorinfo").show(),$(".w400 .anchorinfo").hide(),$("#J_maxonline").show(),$("#J_resize").css("top","102px"),$(".mystore").css("top","102px")),s+=d+2}o.style.width=a+"px",o.style.height=s+"px",o.style.marginTop=-s/2+"px",o.style.marginLeft=30-a/2+"px",common.versions.client&&(o.style.height=s-2+"px",o.style.marginLeft=30-a/2-30+"px"),common.versions.lenovo&&(o.style.height=s-50+"px",o.style.marginTop=-s/2+50+"px",o.style.marginLeft=30-a/2-30+"px",a>i&&$(".w330").height(d-50)),window.onresize=arguments.callee,room.event.resizerank()},ajaxinit:function(){$(document).ajaxError(function(){window.ajaxError=arguments}).ajaxSuccess(function(e,o,t,r){return window.ajaxSuccess=arguments,r&&"number"==typeof r.result?600==r.result?(layer.alert("操作不成功,登录超时!"),void common.layerlogin()):void(1!=r.result&&"粉丝团不存在"!=r.msg&&layer.alert(r.msg||"服务器返回错误!")):void 0}).ajaxComplete(function(){window.ajaxComplete=arguments}).ajaxStart(function(){window.ajaxstart=arguments})},rebuildcommon:function(){var e=common.layerlogin,o=common.layerreg,t=common.layergetpwd,r=common.getmywallet,i=room.__st_reg_guide;common.getmywallet=function(){clearTimeout(i),r(room.pro.scid,function(e){$("#J_reg_guide,.J_layerreg,.J_layerlogin").remove(),$("#J_my_avatar").attr("src",e.data.avatar),$("#J_mygoldcoin").text(room.fn.valuescale(e.data.goldcoin,1));var o=e.data.memberid;if(room.useraction.loginLiveRoom(),room.pro.last_memberid!=o)try{room.useraction.reconnectsocket(),room.pro.last_memberid=o}catch(t){CHAT.socket&&(room.useraction.reconnectsocket(),room.pro.last_memberid=o)}room.render.leftbar(),room.load.loadgift(),room.load.load_item_card(),room.load.load_get_lovegroup(2,function(e){if(1==e.result&&e.data.is_fans){var o=localStorage.getItem("ls_login"),t=$.parseJSON(o);t.group_name=e.data.group.group_name,t.group_level=e.data.fans_level.level;var r=JSON.stringify(t);localStorage.setItem("ls_login",r),room.record.renew(e.data)}}),"beauty"==common.reset.q.type?room.pro.usermessage.settime=setTimeout(function(){if(room.pro.usermessage.islayer&&e.data.level<6){var o={anchor_name:anchor.nickname};common.guide.love_guide("开通",o)}},15e3):setTimeout(room.record.guide,6e4),common.versions.lenovo&&room.lenovo_login()})},common.layerreg=function(e){$("#J_reg_guide").remove(),clearTimeout(i),o(e),$(".close_btn").click(function(){clearTimeout(i),room.__st_reg_guide=setTimeout(room.render.reg_guide,5e3)})},common.layerlogin=function(o){$("#J_reg_guide").remove(),clearTimeout(i),e(o),$(".close_btn").click(function(){clearTimeout(i),room.__st_reg_guide=setTimeout(room.render.reg_guide,5e3)})},common.layergetpwd=function(e){$("#J_reg_guide").remove(),t(e),clearTimeout(i),$(".close_btn").click(function(){clearTimeout(i),room.__st_reg_guide=setTimeout(room.render.reg_guide,5e3)})}},add_watch_his:function(e){var o=localStorage.getItem("watch_his")||"[]";o=$.parseJSON(o);for(var t=[],r=0;r<o.length;r++)o[r].scid==room.pro.scid&&t.push(o[r]);if(!t.length){for(;o.length>20;)o.pop();o.unshift({ytypevt:e.ytypevt,nickname:e.nickname,avatar:e.avatar,memberid:e.memberid,live_title:e.live_title,scid:room.pro.scid}),localStorage.setItem("watch_his",JSON.stringify(o))}},endlive:function(){room.pro.anchor.carouselid&&(room.load.load_micro_recommend(),$(".his").html("直播已经结束")),room.fn.recommend("直播已经结束",room.pro.anchor.covers),CHAT&&CHAT.socket&&CHAT.socket.close(),clearInterval(room.interval),clearInterval(room.mic_interval),room.fn.viewtimelog(),room.load.load_micro_time(0)},recommend:function(e,o){$.ajax({url:room.pro.url.recommend,dataType:"json"}).done(function(t){if(1==t.result){var r={};r.list=t.data,$("#J_w400>*").remove(),r.title=e||"暂无播放内容",r.avatar=o||"/static/img/concern_box.png",$("#J_w400").html(template("room/loadsec/recommend",r))}})},extendglobal:function(){window.YZB={play:function(e){this.pause(),room.__lastts=e||room.__lastts||0,room.load.loadcomment(room.__lastts+1)},seek:function(e){$("#J_msglist").html(""),room.__lastts=1e3*parseInt(e)},pause:function(){for(room.__comment_his=room.__comment_his||[];room.__comment_his.length;)clearTimeout(room.__comment_his.shift());room.__comment_task&&clearTimeout(room.__comment_task),delete room.__comment_task}}},viewtimelog:function(){var e=window.viewtimestartime=window.viewtimestartime||(new Date).getTime();if("function"==typeof window.onbeforeunload){var o=window.onbeforeunload;window.onbeforeunload=function(){o(),room.fn.viewtimelog()}}else window.onbeforeunload=room.fn.viewtimelog;var t=function(){var o=parseInt(((new Date).getTime()-e)/1e3);0>o||o>8e4||(room.fn.wblog({action:"view",extend:{viewstime:e/1e3,viewduration:o,viewetime:(new Date).getTime()/1e3}}),o>10&&(room.fn.viewtimelog=function(){}))};t()},wblog:function(e){var o=common.checklogin();this.randomid=this.randomid||(1e16*Math.random()+1e16).toString(16).substr(2,8)+(1e16*Math.random()+1e16).toString(16).substr(2,7);var t={code:10001,lid:room.pro.scid,action:"",uid:o.memberid||0,macid:this.randomid,status:1,extend:{},w_online:room.pro.online||room.pro.anchor.online||0};$.extend(!0,t,e);var r="";$.each(t.extend,function(e,o){"string"!=typeof o&&(o=JSON.stringify(o)),r+=e+"=>"+o+";"}),r+="wb",t.extend=encodeURIComponent(r),$.ajax({url:"/www/web/web_play_log_report",dataType:"jsonp",type:"get",data:t}),room.pro.isweibo&&$.ajax({url:"//live.weibo.com/proxy/log",dataType:"jsonp",type:"get",data:t})},valuescale:function(e,o,t){if(2==t){var r=[],i=0;e=(e||0).toString().split("");for(var a=e.length-1;a>=0;a--)i++,r.unshift(e[a]),i%3||0==a||r.unshift(",");return r.join("")}if(e=parseInt(e),"number"!=typeof e)return e;if("number"!=typeof o&&(o=2),t){if(e>1e8)return e/=1e8,e.toFixed(o)+"亿";if(e>1e4)return e/=1e4,e.toFixed(o)+"万"}return o>0&&o++,e>=1e8?(e/=1e8,e=e.toFixed(10).toString(),e.substr(0,e.indexOf(".")+o)+"亿"):e>=1e4?(e/=1e4,e=e.toFixed(10).toString(),e.substr(0,e.indexOf(".")+o)+"万"):e}},render:{init:function(){room.fn.rebuildcommon(),window!=window.top&&"wb.yizhibo.com"==location.hostname?room.render.iframe():room.render.notiframe(),room.fn.viewtimelog(),room.load.load_anchor_info(),anchor.carouselid&&room.load.load_micro_info(),room.load.loadgift(),room.load.item_card(),setTimeout(room.load.loadgetroomwatch,2e3),room.load.load_get_lovegroup()},updateanchorgoldcoins:function(e,o){if(e&&!isNaN(e)){var t=$(".J_goldcoin");t.length<1||(e>room.pro.anchor.goldcoin||o)&&(room.pro.anchor.goldcoin=e,e>=1e8?e=(e/1e8).toFixed(1)+"亿":1e8>e&&e>=1e4&&(e=(e/1e4).toFixed(1)+"万"),$(".J_goldcoin").html(e))}},widthvideo:function(){},heightvideo:function(){$(".w400 .anchorinfo").hide()},addanchorgoldcoins:function(e){room.pro.anchor.goldcoin+=parseInt(e),this.updateanchorgoldcoins(room.pro.anchor.goldcoin)},reg_guide:function(e){common.checklogin()||$(".denglu").length>0||!e&&$("#J_reg_guide").length>0||room.pro.widthvideo||$.ajax({url:room.pro.url.recommend,type:"POST",dataType:"json"}).done(function(o){if(1==o.result){if(!e){$("#J_w400").append(template("room/loadsec/reg_guide",{}));var t=$("#J_reg_guide"),r=t.height();t.css("bottom",-1*r+"px"),t.animate({bottom:0},600,function(){});var i=Date.now();setTimeout(function(){Date.now()-i>29e3?$(".rightbtn",t).html("").addClass("close").click(function(){t.remove()}):($(".rightbtn",t).html(parseInt((3e4-Date.now()+i)/1e3)+"秒"),room.__st_reg_guide=setTimeout(arguments.callee,1e3))},1),$(".info span",t).click(function(){$(this).hide(),$("ul",t).height($("#J_reg_guide ul").height()),room.render.reg_guide(1)})}$("#J_reg_guide .info span").show(),common.versions.lenovo&&(o.lenovo=common.versions.lenovo,o.len_parameter=common.versions.len_parameter),$("#J_reg_guide ul").html(template("room/loadsec/reg_guide_comm",o))}})},leftbar:function(){return"0"==common.pro.querystring.lbar||room.pro.isweibo||$("#J_left_bar").html(template("room/base/leftbar",common.checklogin())).show()},resetlogin:function(){iconnect.on("logout",function(){localStorage.removeItem("ls_login"),$.ajax({url:"/member/h5api/logout",global:!1}),$("#J_mygoldcoin").text("0")}),iconnect.on("login",function(e,o,t,r){$.ajax({url:"/member/thirdlogin/weibo_login",type:"POST",dataType:"json",data:{uid:o,action_time:t,sign:r}}).done(function(e){1==e.result&&(common.getmywallet.aj&&common.getmywallet.aj.abort(),common.getmywallet(room.pro.scid))})}),iconnect.trigger("notify"),iconnect.trigger("iframeFixed"),common.layerlogin=function(){iconnect.trigger("uiLogin")},common.recharge=function(e){function o(e,o){$.ajax({url:"//"+r+room.pro.url.get_recharge_list,dataType:"jsonp",jsonp:"callback",data:e}).done(function(e){if(1==e.result){{layer.open({type:1,shift:!1,title:"账户充值",skin:"lay2_recharge",area:["720px","525px"],shade:.3,content:template("room/loadsec/"+o,e.data)})}$("#J_recharge_select li").click(function(){function e(e){$("#J_recharge_select .info span").text(e)}$(this).addClass("on").siblings().removeClass("on");{var o=this.getAttribute("money");this.innerText}o?($("#J_recharge_select .customeized").hide(),e(o)):$("#J_recharge_select .customeized").show().find("input").unbind().keyup(function(){this.value=this.value.replace(/^0+|\D/g,""),e(this.value);var o=0;YZBpay&&"function"==typeof YZBpay.getsubsidygoldcoin&&(o=YZBpay.getsubsidygoldcoin(this.value)),$(this).siblings("span").text("(将获得"+100*this.value+"个金币"+(o>0?"+赠送"+o+"个金币)":")"))})}).eq(0).trigger("click"),$("#J_recharge_select .btn button").unbind().click(function(){var e=layer.load(),o=$("#J_recharge_select .info span").text(),t=window.open("/static/h5/loading.html");$.ajax({url:"//"+r+room.pro.url.submit_recharge,dataType:"jsonp",data:{money:o,productid:$("#J_recharge_select li.on").attr("pid")||998}}).done(function(e){1==e.result&&(t.location.href=e.data,common.pay())}).always(function(){layer.close(e)})})}})}try{e.stopPropagation(),e.preventDefault()}catch(t){}var r=location.hostname.substr(0,location.hostname.indexOf("."));if(r+=".","dev."!=r&&"test."!=r&&(r=""),common.checklogin())o({},"recharge");else try{return common.layerlogin(),e.stopPropagation(),e.preventDefault(),!1}catch(t){}}},iframe:function(){room.pro.isweibo=!0,this.resetlogin(),$("#J_anchor_more").hide(),setTimeout(function(){var e=$("#J_resize").position().top+180;$(".gift_his").css({top:e,height:"auto"})},1e3),$(document).delegate("a","click",function(e){var o=$(this);if(o.attr("target")){var t=o.attr("weibo_openid");if(t)o.attr("href","//weibo.com/"+t);else if(o.attr("target").indexOf("top")<0)return e.stopPropagation(),e.preventDefault(),!1}}),$("#J_live_box").addClass("w1000").css({marginLeft:"0",marginTop:"0",left:"0",top:0}),$("#J_gift_normal .hide").eq(1).remove(),$("#J_gift_normal .hide").eq(1).remove(),$(".w360").append(template("room/wbico",{})),$("#J_wbico .ico2").click(function(){common.layertask();var e=new Image;e.src="//www.yizhibo.com/static/images/img/1.png?p_from=Weibo.task"}),$(document).undelegate(".J_recharge","click"),$(".J_recharge").unbind(),$(document).delegate(".J_recharge","click",common.recharge)},notiframe:function(){common.versions.client||common.versions.lenovo||"0"==common.pro.querystring.lbar||setTimeout(this.rendertasktip,5e3),1==common.reset.q.len_ovo&&$(".room").css({background:"none"}),common.checklogin()&&common.getmywallet(room.pro.scid),room.load.loadcorner(),room.render.leftbar(),$("body").delegate(".J_u_card","click",function(e){e.stopPropagation(),e.preventDefault();var o=this;$.ajax({url:room.pro.url.getmemberinfo,dataType:"json",data:{memberid:$(o).attr("data-memberid"),anchormemberid:room.pro.anchor.memberid}}).done(function(e){if(e&&1==e.result){var o=common.checklogin();o?(e.data.mymemberid=o.memberid,e.data.anchorid=room.pro.anchor.memberid,e.data.ismaster=o.memberid==room.pro.anchor.memberid,e.data.iscontrol=o.iscontrol):(e.data.iscontrol=0,e.data.ismaster=0),$(".layer_memberinfo").length&&layer.closeAll(),e.data.lenovo=common.versions.lenovo,e.data.len_parameter=common.versions.len_parameter;{layer.open({type:1,title:!1,closeBtn:0,area:["340px","auto"],skin:"layer_memberinfo",shade:.3,content:template("room/memberinfo",e.data),shadeClose:!0,success:room.event.userinfocard})}}})})},rendertasktip:function(){function e(){o=$(o),$("body").append(o),o.css({opacity:0}),o.animate({opacity:1},600).click(function(){$(this).remove()}),setTimeout(function(){o.fadeOut("600")},1e4)}var o,t=common.checklogin();t?$.ajax({url:common.url.task,type:"post",dataType:"json",data:{memberid:t.memberid,taskid:1}}).done(function(t){1==t.result&&(0!=t.a1.data.status||t.a2.data&&0!=t.a2.data.status||(o=template("room/task_login",t),e()))}):(o=template("room/task_login",{}),e())}},load:{loadgift:function(){var e="//";location.host.indexOf("chkd")>-1&&(e+="chkd."),location.host.indexOf("test")>-1&&(e+="test."),location.host.indexOf("dev")>-1&&(e+="dev."),"https:"==location.protocol&&(e="//"),room.pro.url.getgiftlist=room.pro.url.getgiftlist.replace("//pay",e+"pay"),$.ajax({url:room.pro.url.getgiftlist,dataType:"jsonp",data:{scid:room.pro.scid,anchorid:anchor.memberid||room.pro.anchor.memberid}}).done(function(e){if(e&&1==e.result){for(var o=[],t=[],r=0;r<e.data.list.length;r++){var i=e.data.list[r];
room.pro.gift["gift"+i.giftid]=i,1!=i.type&&2!=i.type&&3!=i.type&&6!=i.animationtype&&(1==i.isbursts?o.push(i):t.push(i))}for(var r=0;r<e.data.nodisplay.length;r++){var i=e.data.nodisplay[r];room.pro.gift["gift"+i.giftid]=i}for(;Math.abs(o.length-t.length)>1;)o.length>t.length?t.push(o.pop()):o.push(t.pop());e.data.list=o,$("#J_giftaction .giftlist .mark").html(template("room/gift/giftdetail",e.data)),e.data.list=t,$("#J_giftaction .giftlist .mark").append(template("room/gift/giftdetail",e.data))}})},item_card:function(){$("#J_giftaction .gift_btn").html('<div class="move_box"></div>                            <div class="tab_box"><p data-value="1" class="tab tabon">礼物</p><p data-value="2" class="tab">道具卡</p></div>'),$("#J_giftaction .gift_move").append('<div class="itemcard"></div>');var e=$(".gift_btn .move_box"),o=$("#J_giftaction .mark"),t=$("#J_giftaction .gift_move"),r=$("#J_giftaction .itemcard").css({display:"none"});$(document).delegate("#J_giftaction .tab","click",function(){var i=$(this),a=i.attr("data-value")-1;e.stop().animate({marginLeft:63*a},200),i.addClass("tabon").siblings().removeClass("tabon"),t.css({left:0}),1==i.attr("data-value")?(o.css({display:"block"}),r.css({display:"none"})):(o.css({display:"none"}),r.css({display:"block"})),$("#J_giftaction .window .btn").removeClass("x_choosegift")}).delegate("#J_giftaction .card_list","click",function(){var e={},o=$(this);o.hasClass("card_inuse")||(e.cardid=this.getAttribute("data-cardid"),e.propname=this.getAttribute("data-propname"),e.desc=this.getAttribute("data-desc"),e.cover=this.getAttribute("data-src"),e.hourslength=this.getAttribute("data-hourslength"),e.category=this.getAttribute("data-category"),e.proptype=this.getAttribute("data-proptype"),room.load.load_card_confirm(e,o))});var i=null;$("#J_giftaction").delegate(".giftlist .img_card","mouseenter",function(e){e.stopPropagation(),e.preventDefault();var o={};o.cardid=this.getAttribute("data-cardid"),o.propname=this.getAttribute("data-propname"),o.desc=this.getAttribute("data-desc"),o.cover=this.getAttribute("data-src"),o.hourslength=this.getAttribute("data-hourslength"),i=layer.tips(template("room/gift/cardhover",o),this,{tips:[1,"rgba(0,0,0,0.9)"],area:["294px","auto"],time:3336e3,skin:"layer-pmd5",anim:2})}).delegate(".giftlist .img_card","mouseleave",function(){layer.close(i)}),room.load.load_item_card()},load_card_confirm:function(e,o){function t(o,t,r){var i={data:o,check_use:r||{},anc_name:anchor.nickname};layer.open({type:1,title:["","color:#fff;"],closeBtn:1,shade:.3,shadeClose:!0,area:["478px","291px"],skin:"card_confirm",content:template("room/gift/giftconfirm",i),success:function(){$(".card_confirm .layui-layer-title").remove(),$(".card_confirm .layui-layer-content").css({height:"100%"}),$(".cancel").on("click",function(){layer.closeAll()}),$(".yes").on("click",function(){layer.closeAll();this.getAttribute("data-cardid");e.num=i.check_use.card_num,room.load.card_inuse(o,t)})}})}1==e.proptype?$.ajax({url:"/activity/h5api/check_use_prop_card",type:"POST",dataType:"json",global:!1,data:{prop_id:e.cardid,scid:anchor.scid},success:function(r){return 1!=r.result?void common.reset.commonalertmsg(r):void t(e,o,r.data)}}):t(e,o)},card_inuse:function(e,o){$.ajax({url:"/activity/h5api/use_prop_card",type:"POST",dataType:"json",global:!1,data:{prop_category:e.category,prop_id:e.cardid,scid:anchor.scid,num:e.num},success:function(e){return 1!=e.result?void common.reset.commonalertmsg(e):(layer.open({type:1,title:["","color:#fff;"],closeBtn:1,shade:.3,shadeClose:!0,area:["370px","191px"],skin:"layer_cardafter",content:template("room/gift/cardafter",e),success:function(){$(".layer_cardafter .layui-layer-title").remove(),$(".layer_cardafter .layui-layer-content").css({height:"100%"}),$(".layer_cardafter .btn").on("click",function(){layer.closeAll()})}}),o.addClass("anim"),void setTimeout(function(){room.load.load_item_card()},1e3))}})},load_item_card:function(e){function o(e){var o=$(".giftlist .itemcard_box");o.prepend(template("room/gift/giftcarduse",e));var r=e.surplus_time,i=setInterval(function(){return 0>r?(clearInterval(i),$("#span"+e.card_id).remove(),void(o.find("span").length<1&&o.html('<div class="none_box">天呐！您还没有道具卡<br>参加活动可以赢取道具卡哦。</div>'))):($("#count"+e.card_id).html(t(r)),void r--)},1e3);$("#J_giftaction .gift_move").css({left:0})}function t(e){function o(e){var o="";return $.each(e.split(":"),function(e,t){t=parseInt(t),o+=10>t?":0"+t:":"+t}),o.slice(1)||"00:00:00"}var t=parseFloat(e);return t=t>60&&3600>t?"00:"+parseInt(t/60)+":"+parseInt(60*(parseFloat(t/60)-parseInt(t/60))):t>=3600?parseInt(t/3600)+":"+parseInt(60*(parseFloat(t/3600)-parseInt(t/3600)))+":"+parseInt(60*(parseFloat(60*(parseFloat(t/3600)-parseInt(t/3600)))-parseInt(60*(parseFloat(t/3600)-parseInt(t/3600))))):"00:00:"+parseInt(t),o(t)}$.ajax({url:room.pro.url.getprop_cards,type:"GET",dataType:"json",global:!1,data:{scid:anchor.scid},success:function(t){t.datalength=1,t.data&&t.data.length&&(t.datalength=0),$("#J_giftaction .giftlist .itemcard").html(template("room/gift/giftcard",t)),1==t.result&&1!=t.datalength&&($.each(t.data,function(e,t){t.is_using&&o(t)}),"function"==typeof e&&e())}})},loadgetroomwatch:function(){var e="//";location.host.indexOf("test")>-1&&(e+="test."),location.host.indexOf("dev")>-1&&(e+="dev."),"https:"==location.protocol&&(e="//"),room.pro.url.getroomwatch=room.pro.url.getroomwatch.replace("//pay",e+"pay"),$.ajax({url:room.pro.url.getroomwatch,dataType:"jsonp",data:{scid:room.pro.scid}}).done(function(e){e&&1==e.result&&e.data&&(e.data.name=e.data.giftname,e.data.memberid=e.data.memberId,view.giftquery(e.data))})},load_anchor_status:function(){},load_get_royal:function(){$.ajax({url:room.pro.url.get_royal,dataType:"json",data:{scid:room.pro.scid},global:!1}).done(function(e){var o={data:e.data||[],usermsg:common.checklogin()};room.pro.nobler.noble_num++,room.pro.nobler.noble_num>3&&(room.pro.nobler.bool=!1),setTimeout(function(){room.pro.nobler.bool=!0,room.pro.nobler.noble_num=0},12e3),room.pro.nobler.list=e.data;var t=template("room/peerage/peerage_list",o);$("#x_peerage").html()!=t&&$("#x_peerage").html(t),1!=e.result})},load_site_rank:function(){$.ajax({url:room.pro.url.get_site_rank,dataType:"json",data:{scid:room.pro.scid},global:!1}).done(function(e){401==e.result&&room.fn.endlive(e.msg,""),1==e.result&&(e.data.list=e.data.list||[],$("#J_rank_1").html(template("room/rank/rank_width",e.data)),room.pro.siterank=e.data.list)})},load_normal_rank:function(){$.ajax({url:room.pro.url.get_normal_rank,dataType:"json",data:{memberid:room.pro.anchor.memberid,limit:15},global:!1}).done(function(e){e&&1==e.result&&(e.data.list=e.data.list||[],$("#J_normal_rank").html(template("room/rank/rank_width",e.data)))})},load_anchor_info:function(){function e(e){$(".w400 .anchorinfo").html(template("room/base/anchor_info",e)),$(".J_anchorid").html(e.icontext||"一直播ID: "+e.memberid),$("#J_anchorstartdate").html((e.starttime&&new Date(1e3*e.starttime)||new Date).Format("yyyy.MM.dd")),room.pro.anchor=e,room.pro.anchor.width=parseInt(room.pro.anchor.width),room.pro.anchor.height=parseInt(room.pro.anchor.height),(room.pro.widthvideo=room.pro.anchor.width>room.pro.anchor.height)?room.render.widthvideo():room.render.heightvideo(),room.fn.resizevideo(),room.status=e.status,$.ajax({url:"//pay.yizhibo.com/wallet/api/get_anchor_income_h5",dataType:"jsonp",data:{anchorid:room.pro.anchor.memberid}}).done(function(e){1==e.result}),room.render.updateanchorgoldcoins(room.pro.anchor.goldcoin,1),$("#J_anchor_more").attr("href","/member/personel/user_info?memberid="+e.memberid+"&jumpbrowser=1"),room.pro.anchor.is_follow>0&&room.useraction.smallwidthvideofollow(),room.load.load_normal_rank(),room.load.load_get_royal(),room.pro.isweibo||room.pro.widthvideo||"beauty"==common.reset.q.type||setTimeout(room.render.reg_guide,5e3),"beauty"==common.reset.q.type&&(common.beautys=setTimeout(common.layerreg,5e3)),setTimeout(function(){$(".w400").css("overflow","hidden"),$("#J_flash").attr("width","100%").css("margin-left","0")},300),room.pro.anchor.carouselid||room.fn.add_watch_his(e),$("#giftpendant").length<1&&$("#J_cover").append('<div id="giftpendant" class="giftpendant"></div>');var o="//static.yizhibo.com/pc_live/static/video.swf?";switch(e.status=parseInt(e.status),e.status){case 10:if(anchor.carouselid?room.interval=setInterval(function(){room.load.load_get_royal()},3e5):(room.load.load_site_rank(),room.load.load_all_member(),room.interval=setInterval(function(){room.load.load_site_rank(),room.load.load_all_member(),room.load.load_get_royal()},3e5)),setTimeout(function(){XinCHAT.getltoken(room.pro.scid)},room.pro.isweibo?1e3:0),$("#J_send_danmu").click(function(){$(this).toggleClass("on"),$(this).hasClass("on")&&($("#J_send_danmu .tip").show(),setTimeout(function(){$("#J_send_danmu .tip").fadeOut(200)},4e3))}),$("#J_w400").append('<div class="disable"></div>'),room.fn.videojs())return;break;case 11:room.fn.extendglobal(),room.load.load_get_royal(),o+="onPlay=YZB.play&onPause=YZB.pause&onSeek=YZB.seek&";var t=$(".J_tog_1 li");if(setTimeout(function(){t.eq(2).trigger("click")}),$("#J_contrl>*").hide(),$("#J_praise").show(),$("#J_maxonline").html("精彩回放"),$("#J_goldcoin").remove(),room.load.loadcomment(0),room.fn.videojs())return;break;default:room.pro.anchor.carouselid?room.load.load_micro_recommend():room.fn.recommend("暂无播放内容",e.cover)}o+="scid="+room.pro.scid,swfobject.embedSWF(o,"J_flash","100%","100%","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always",wmode:"Opaque",onPlay:"alert",onPause:"alert()"},null,function(e){e.success||layer.alert("您的浏览器不支持直播使用的flash,请先安装flash插件后刷新本页面!",function(){window.open("https://get.adobe.com/cn/flashplayer/")})})}location.search.indexOf("fe_debug")>0?$.ajax({url:room.pro.url.get_anchor_info,dataType:"json",data:{scid:room.pro.scid}}).done(function(o){o&&1==o.result&&e(o.data)}):e(anchor||{})},load_all_member:function(){$.ajax({url:room.pro.url.get_all_member,dataType:"json",data:{scid:room.pro.scid}}).done(function(e){if(e&&1==e.result){var o=template("room/rank/all_member",e.data);$("#J_rank_2").html()!=o&&$("#J_rank_2").html(o),room.pro.watcher=e.data.list}})},jsonSort:function(e,o,t){if(e.length<2||!o||"object"!=typeof e[0])return e;"number"==typeof e[0][o]&&e.sort(function(e,t){return e[o]-t[o]}),"string"==typeof e[0][o]&&e.sort(function(e,t){return parseInt(e[o])-parseInt(t[o])}),t&&e.reverse();var r=[],i={};hash_={};for(var a=0;a<e.length;a++)if(e[a]){var n=e[a].memberid_||e[a].memberid,s=e[a].nickname_||e[a].memberid;i[n]||(hash_[s]||(r.push(e[a]),hash_[s]=!0),i[n]=!0)}return r},load_watcher:function(e){if(e){room.pro.watcher=room.pro.watcher.slice(0,30),room.pro.watcher=room.load.jsonSort(room.pro.watcher.concat(e),"level_",!0);var o={list:room.pro.watcher.slice(0,30)},t=template("room/rank/all_member",o);$("#J_rank_2").html()!=t&&$("#J_rank_2").html(t),e.nobleLevel_&&(e.nobleLevel_=parseInt(e.nobleLevel_)),e.nobleLevel_>0&&room.pro.nobler.bool&&setTimeout(room.load.load_get_royal,5e3)}},load_siterank:function(e){room.pro.siterank=room.pro.siterank.slice(0,30);var o=!0;if(room.pro.gift["gift"+e.giftid_]&&room.pro.gift["gift"+e.giftid_].goldcoin>0){$.each(room.pro.siterank,function(t,r){r.memberid==e.memberid_&&(r.gold_num+=room.pro.gift["gift"+e.giftid_].goldcoin,o=!1)}),o&&room.pro.siterank.push({nickname:e.nickname_,avatar:e.avatar_,memberid:e.memberid_,gold_num:room.pro.gift["gift"+e.giftid_].goldcoin,level:e.level_}),room.pro.siterank=room.load.jsonSort(room.pro.siterank,"gold_num",!0);var t={list:room.pro.siterank.slice(0,8)};if(anchor.carouselid)return;var r=template("room/rank/rank_width",t);$("#J_rank_1").html()!=r&&$("#J_rank_1").html(r)}},load_switch_anchor:function(e){"string"==typeof e&&(e=$.parseJSON(e)),e.nextMemberId_!=room.pro.mic_current.id&&void 0!==e.nextScid_&&e.nextScid_&&(room.load.load_micro_time(0),room.load.load_micro_recommend(),null!==e.nextScid_&&($.ajax({url:room.pro.url.get_basic_live_info,dataType:"json",data:{scid:e.nextScid_}}).done(function(o){o&&1==o.result&&(o.data.carouselid=e.queuingRoomScid_,room.load.load_micro_data(o.data),o.data.carouselid=window.anchor.carouselid,o.data.icontext=window.anchor.icontext,window.anchor=o.data,room.load.load_micro_flash(e.nextScid_,e.nextMemberId_),room.load.load_get_lovegroup(2))}),room.load.load_micro_list1(),room.load.load_micro_list2()))},load_micro_data:function(e){var o={anchor:e,adjacent_liveinfo:{},micorder_list:{},micro_appearance:{},seonickname:""};$.ajax({url:room.pro.url.get_micorder_list,dataType:"json",type:"POST",data:{scid:room.pro.anchor.carouselid}}).done(function(e){e&&1==e.result&&(o.micorder_list=e.data,$.ajax({url:room.pro.url.get_micro_appearance,dataType:"json",type:"POST",data:{scid:room.pro.anchor.carouselid}}).done(function(e){if(e&&1==e.result){o.micro_appearance=e.data.list,$("#J_anchorinfo .his").html(template("room/microphone/micro_info",o)),common.jscroll($(".micro_order .J_scroll"));try{room.load.load_micro_time(o.micorder_list.list[0].remain_duration)}catch(t){room.load.load_micro_time(0)}}}))})},load_micro_info:function(){room.pro.anchor.scid==room.pro.anchor.carouselid?room.load.load_micro_recommend():(room.load.load_micro_data(room.pro.anchor),room.load.load_micro_flash(room.pro.anchor.scid,room.pro.anchor.memberid)),$(".J_anchorid").html(room.pro.anchor.icontext),$.ajax({url:room.pro.url.micorder_detail,dataType:"json",type:"POST",data:{scid:room.pro.anchor.carouselid}}).done(function(e){e&&1==e.result&&($("#J_anchorinfo .J_u_card a img").attr("src",e.data.mic_house_logo),$(".info .nickname a").html(e.data.mic_house_name),$(".info .id").html(e.data.mic_house_desc).addClass("txt-cut").css({"max-width":"170px"}),$("#J_anchorinfo .avatar").attr("data-memberid",parseInt(room.pro.anchor.carousel_id.replace(/[^0-9]/gi,""))),$(".info .rem_time").remove())}),room.load.load_micro_list1(),room.load.load_micro_list2(),room.mic_interval=setInterval(function(){room.load.load_micro_list1(),room.load.load_micro_list2()},36e3)},load_micro_list2:function(){$.ajax({url:room.pro.url.get_micro_list,dataType:"json",type:"POST",data:{flag:8,scid:room.pro.anchor.carouselid}}).done(function(e){e&&1==e.result&&$("#J_normal_rank").html(template("room/rank/rank_width",e.data))})},load_micro_list1:function(){$.ajax({url:room.pro.url.get_micro_list,dataType:"json",type:"POST",data:{flag:10,scid:room.pro.anchor.carouselid}}).done(function(e){e&&1==e.result&&$("#J_rank_1").html(template("room/rank/rank_width",e.data))})},load_micro_time:function(e){function o(){r++,e--,0>e&&(e=0,clearInterval(room.pro.rem_time));var i=(new Date).getTime()-(t+1e3*r),a=1e3-i;0>a&&(a=0),room.pro.rem_time=setTimeout(o,a),$(".micro_li1 .remaining_time").html("剩余时间："+e+"秒"),$(".start_time1").html("正在直播 剩余："+e+"秒")}clearInterval(room.pro.rem_time),e=parseInt(e)||0,room.pro.rem_time=setTimeout(o,1e3);var t=(new Date).getTime(),r=0},load_micro_flash:function(e,o){if(room.pro.mic_current.scid=e,room.pro.mic_current.id=o,room.fn.videojs(1))return void setTimeout(function(){$("#micro_recommend").remove()},2e3);setTimeout(function(){$("#micro_recommend").remove()},2e3);var t="//static.yizhibo.com/pc_live/static/video.swf?";t+="scid="+e,swfobject.embedSWF(t,"J_flash","200%","100%","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always",wmode:"Opaque",onPlay:"alert",onPause:"alert()"},null,function(e){e.success||layer.alert("您的浏览器不支持直播使用的flash,请先安装flash插件后刷新本页面!",function(){window.open("https://get.adobecom/cn/flashplayer/")})}),$(".w400").css("overflow","hidden"),$("#J_flash").attr("width","100%").css("margin-left","0")},load_micro_recommend:function(){$.ajax({url:room.pro.url.micorder_detail,dataType:"json",type:"POST",data:{scid:room.pro.anchor.carouselid}}).done(function(e){e&&1==e.result&&($("#J_anchorinfo .J_u_card a img").attr("src",e.data.mic_house_logo),$(".info .nickname a").html(e.data.mic_house_name),$(".info .id").html(e.data.mic_house_desc),$(".info .rem_time").remove())});var e={};e.title="主播正在赶来...",e.avatar="/static/img/concern_box.png",$("#micro_recommend").length>0||$("#J_w400").append(template("room/microphone/micro_recommend",e))},loadcomment:function(e){e=e||0,room.__comment_task&&clearTimeout(room.__comment_task),delete room.__comment_task;var o=parseInt(e);$.ajax({url:room.pro.url.getplalycomment,dataType:"json",data:{scid:room.pro.scid,ts:e}}).done(function(t){function r(e){room.__comment_his.push(setTimeout(function(){view.add(e),room.__lastts=parseInt(e.ts),room.__comment_his&&room.__comment_his.length&&room.__comment_his.shift()},parseInt(e.ts)-o))}if(!room.__comment_task&&(room.__comment_his=room.__comment_his||[],1==t.result)){if(t.data.count<30)room.__comment_task=setTimeout(function(){room.load.loadcomment(e+3e4+1)},3e4);else{var i=t.data.list[29];if(e>i.ts)return void(room.__comment_task=setTimeout(function(){room.load.loadcomment(parseInt(e+1e3)+1)},0));room.__comment_task=setTimeout(function(){room.load.loadcomment(parseInt(i.ts)+1)},parseInt(i.ts)-o)}for(var a=0;a<t.data.list.length;a++){var i=t.data.list[a];i.avatar_=i.avatar,i.content_=i.content,i.level_=i.level,i.nickname_=i.nickname,i.memberid_=i.memberid,r($.extend({createtime:"1470621325",iscontrol:"0",sex:"2",ytypename:"普通",experience:"836",ytypevt:"0",mtype:"0",scid:room.pro.scid},i))}}})},getmyfreegift:function(){common.checklogin()?$.ajax({url:"/tasksystem/web/get_pc_member_giftnum",type:"post",dataType:"json",global:!1}).done(function(e){if(1==e.result&&0!=e.data.showstatus){$("#J_cover>.freestar").remove(),$("#J_cover").append(template("room/gift/freestar",e.data));var o=document.getElementById("J_border").getContext("2d"),t=function(e){e||(e=17),40==e&&(e=17),o.globalAlpha=(40-e)/30,o.clearRect(0,0,100,100),o.beginPath(),o.arc(50,50,e,0,2*Math.PI,!0),o.fillStyle="rgb(255,255,255)",o.fill(),e++,setTimeout(function(){t(e)},30)};"0"!=e.data.giftnum&&t()}}):console.log("未登录")},loadcorner:function(){var e=(arguments.callee,"//"),o="";try{var t=/^((\w+)\.)((?=(hd|api|m|www|pay|activity).yizhibo.com)|(?=api.xiaoka.tv))/.exec(location.hostname);t&&(o=t[0],e="//"+o)}catch(r){}$.ajax({url:e+"activity.yizhibo.com/ac_adv/web/get_live_adv",dataType:"jsonp",data:{scid:room.pro.scid},global:!1}).done(function(o){if(!(1!=o.result||o.data.jb.list.length<1)){var t=(o.data.jb.list[0].h5_url||e+"activity.yizhibo.com/special/h5corner.html").replace(/(http:|https:)/g,"");t+=t.indexOf("?")>0?"&":"?",$("#J_cover").append('<div class="h5corner"><iframe src="'+t+"scid="+anchor.scid+'" frameborder="0" width="91" height="91" scrolling="no"></iframe></div>')}})},load_get_lovegroup:function(e,o){return $.ajax({url:"/group/h5api/group_info_fans",type:"POST",dataType:"json",data:{anchor_id:anchor.memberid,full_screen:0},global:!1,success:function(t){return o&&o(t),1!=t.result?(window.fans_msgs=null,void $("#anchor_true_love_group").html("")):(window.fans_msgs=t.data,!t.data.is_fans&&$("#follow_330").hasClass("followcount")&&$("#follow_330").removeClass().addClass("true_follow").html(""),void room.load.load_get_fansmsg(t,e))}})},load_get_fanslist:function(e,o){$.ajax({url:"/group/h5api/fans_rank",type:"POST",dataType:"json",data:{group_id:o,is_week:e,page:0,limit:30},success:function(e){e&&1==e.result&&$(".ranking_hover_con ul").html(template("room/fans_group/s_fans_list",e.data))}})},load_get_fansmsg:function(e,o){$.ajax({url:"/group/h5api/fans_rank",type:"POST",dataType:"json",data:{group_id:e.data.group.group_id,is_week:0,page:0,limit:30},success:function(t){$.ajax({url:"/group/h5api/group_news",type:"POST",dataType:"json",data:{anchor_id:anchor.memberid},success:function(r){var i={group:e.data,fans_list:t.data.list,guard:r.data};room.load.true_love_group(i,o)}})}})},true_love_group:function(e,o){function t(e,o,t){var r=t,i=e,a=$(".empirical_value").width()/r*i;$(".empirical_value .orange").css("width",a)}function r(e){var o=$(e),t=0,r=o.height(),i=o.width();o.append(o.find("p").first()),".tl_scrollbox"==e?setInterval(function(){t==r&&(t=0),o.css("marginTop","-"+t+"px"),t+=1},50):setInterval(function(){t==i&&(t=0),o.css("marginLeft","-"+t+"px"),t+=1},50)}if(room.pro.anchor.width<room.pro.anchor.height){var i=$(".resize");if($("#anchor_true_love_group").html(template("room/fans_group/room_fans_g",e)),$(".true_love_box").css("height","auto"),r(".tl_scrollbox"),2!=o){if(0==e.fans_list.length){var a=parseInt(i.css("top"))+100;$(".tl_ranking").css("padding","0"),$(".true_love_box").css("height","100px")}else var a=parseInt(i.css("top"))+137;i.css("top",a)}}else $("#J_resize .J_tog_1").addClass("tit2"),$(".r_love_group").length<1&&$(".J_tog_1 .last").before('<li class="r_love_group">真爱团</li>'),$(".h_love_group").length<1?($("#J_rank_2").after(template("room/fans_group/h_fans_list",e)),r(".h_tl_scrollbox")):($("#J_rank_2").next().remove(),$("#J_rank_2").after(template("room/fans_group/h_fans_list",e)),r(".h_tl_scrollbox"));common.jscroll(),$(".tl_ranking").on("mouseenter",function(){$(".tl_ranking_hover").show()}).on("mouseleave",function(){$(".tl_ranking_hover").hide()}),$(".tl_task").on("click",function(){}),$(".ranking_hover_top div").on("click",function(){var o=$(this).attr("data-hover");$(this).addClass("love_on").siblings().removeClass("love_on"),room.load.load_get_fanslist(o,e.group.group.group_id)}),t(e.group.group.score,e.group.level.min,e.group.level.max),r(),room.event.resizerank()}},record:{guide:function(){function e(){room.pro.usermessage.settime=setTimeout(function(){if($(".layui-layer-shade").length<1){var o={anchor_name:anchor.nickname};return void common.guide.love_guide("开通",o)}return void e()},2e3)}clearTimeout(room.pro.usermessage.settime);var o=common.checklogin();room.pro.usermessage.islayer&&o&&!o.group_name&&o.level<6&&e()},giftguide:function(e){if(!(e.group_name||e.level>5)&&(room.pro.usermessage.goldnumner+=e.price*e.amount,room.pro.usermessage.islayer&&room.pro.usermessage.goldnumner>=100)){clearTimeout(room.pro.usermessage.settime);var o={anchor_name:anchor.nickname};common.guide.love_guide("开通",o)}},commentguide:function(e){if(!(e.group_name||e.level>5)&&(room.pro.usermessage.comment++,room.pro.usermessage.islayer&&room.pro.usermessage.comment>=10)){clearTimeout(room.pro.usermessage.settime);var o={anchor_name:anchor.nickname};common.guide.love_guide("开通",o)}},renew:function(e){if(room.pro.usermessage.islayer){var o=new Date(e.expire_time)-new Date,t=Math.ceil(o/864e5);if(7>=t){var r={anchor_name:anchor.nickname,annum:t};common.guide.love_guide("续费",r)}}}},useraction:{smallwidthvideofollow:function(e){if(room.pro.widthvideo){var o=$("#J_w400 .anchorinfo_top").width(210);e&&e.remove(),setTimeout(function(){o.stop().fadeOut(500,function(){$("#J_maxonline").show()})},5e3),$("#J_w400").hover(function(){o.stop().fadeIn(500),$("#J_maxonline").hide()},function(){o.stop().fadeOut(500,function(){$("#J_maxonline").show()})})}},sendstar:function(){var e=$("#J_freestar"),o=e.text().replace(/\D+/g,"");if(o=parseInt(o),!(parseInt(o)<1)){var t={scid:room.pro.scid,amount:1,giftid:e.attr("data-giftid"),price:0,type:0,childtype:0,name:e.attr("data-name")||"礼物",cover:e.attr("data-img")||"//alcdn.img.xiaoka.tv/20161128/c30/3f2/0/c303f2931b12d2c62c4e28730fd96bf0.png",isbursts:1};room.useraction.sendgift(t,room.load.getmyfreegift)}},sendgift:function(e,o){return e.giftid?!e.amount||e.amount<1?void layer.alert("礼物数量不正确!"):(room.pro.anchor.carouselid&&(e.carouselid=anchor.carouselid,e.scid=room.pro.mic_current.scid),void common.afterlogin(function(){$.ajax({url:room.pro.url.gift,type:"POST",dataType:"json",data:e,global:!1}).done(function(t){if(3==t.res_check_mobile)return void room.useraction.bind_mobile_phone(t);if(2==t.res_check_mobile)return void room.useraction.bind_mobile_phone(t);if(1!=t.result)return void("4"==e.type?layer.msg(e.forbbidenTips):common.reset.commonalertmsg(t,function(){100==t.result&&common.recharge(),102==t.result&&common.afterlogin(common.layerpayment(fans_msgs,"开通"))}));if(room.fn.wblog({action:"send_gift",extend:{ownerid:room.pro.anchor.weibo_openid,yzbid:room.pro.anchor.memberid,giftcoin:e.price||0,giftid:e.giftid}}),"function"==typeof o&&o(t),4!=e.type){var r=common.checklogin();r.goldcoin=t.data.goldcoin,common.useraction.savemywallet(r),$("#J_mygoldcoin").html(room.fn.valuescale(t.data.goldcoin,1))}if($("#x_free_"+e.giftid).html(t.data.count),t.data.count<1&&room.load.loadgift(),$.extend(e,r,{goldcoins:room.pro.anchor.goldcoin}),room.record.giftguide(e),1==e.type)return e.content_=e.content,e.avatar_=e.avatar,e.goldcoin_=e.goldcoin,e.level_=e.level,e.memberid_=e.memberid,e.nickname_=e.nickname,e.iscontrol_=e.iscontrol,e.cmdId=310,void view.msgrender(e,1);var i=e.price*e.amount;room.render.addanchorgoldcoins(i),e.goldcoins+=e.price,e.amount_=e.amount,e.avatar_=e.avatar,e.childtype_=e.childtype,e.cover_=e.cover,e.giftid_=e.giftid,e.goldcoin_=e.goldcoin,e.isbursts_=e.isbursts,e.level_=e.level,e.memberid_=e.memberid,e.nickname_=e.nickname,view.rendergift(e),room.render.updateanchorgoldcoins(e.goldcoins,1),10==e.type&&layer.msg("礼物正在飞向主播，请稍后")})})):void layer.alert("请先选择礼物!")},reconnectsocket:function(){XinCHAT._socket.close(),XinCHAT.getltoken(room.pro.scid)},loginLiveRoom:function(){var e=$.cookie("yxa_did"),o=room.pro.scid,t=location.hostname.substr(0,location.hostname.indexOf("."));t=t.indexOf("test")>-1?"test.":t.indexOf("chk")>-1?"chka.":"",$.ajax({url:"//"+t+"app.yizhibo.com/com.yzb.msg.upstream.api.UpStreamService/1.0.0/loginLiveRoom",type:"GET",dataType:"jsonp",jsonp:"callback",data:{_p:'{"_did": "'+e+'","_appid": "23","_pkgname": "h5.yizhibo.live","_language": "zh"}',scid:'"'+o+'"'},success:function(e){console.log("loginLiveRoom",e.msg)}})},logoutLiveRoom:function(){var e=$.cookie("yxa_did"),o=room.pro.scid,t=location.hostname.substr(0,location.hostname.indexOf("."));t=t.indexOf("test")>-1?"test.":t.indexOf("chk")>-1?"chka.":"",$.ajax({url:"//"+t+"app.yizhibo.com/com.yzb.msg.upstream.api.UpStreamService/1.0.0/logoutLiveRoom",type:"GET",dataType:"jsonp",jsonp:"callback",data:{_p:'{"_did": "'+e+'","_appid": "23","_pkgname": "h5.yizhibo.live","_language": "zh"}',scid:'"'+o+'"'},success:function(e){console.log("logoutLiveRoom",e.msg)}})},comment:function(){var e=$(this).siblings(".text"),o=e.val();return o.length<1?void layer.alert("请输入发言内容!"):(e.val(""),void common.afterlogin(function(e){if(room.pro.anchor.memberid==e.memberid)return void layer.alert("主播不能自己评论!");if($("#J_send_danmu").hasClass("on")){var t={scid:room.pro.scid,giftid:19,amount:1,message:o,type:1,content:o,mtype:"0",ts:"0",createtime:(new Date).getTime(),isDanmaku:"true",price:10,dm_type:1};return void room.useraction.sendgift(t)}$.ajax({url:room.pro.url.comment,type:"POST",dataType:"json",global:!1,data:{scid:room.pro.scid,comment:o,is_carousel:room.pro.anchor.carouselid?!0:!1}}).done(function(e){if(e&&1==e.result){if(3==e.res_check_mobile)return void room.useraction.bind_mobile_phone(e);if(2==e.res_check_mobile)return void room.useraction.bind_mobile_phone(e);room.fn.wblog({action:"user_msg",extend:{ownerid:room.pro.anchor.weibo_openid,yzbid:room.pro.anchor.memberid}});var t={},r=common.checklogin();t={createtime:Date.now(),content:o,scid:room.pro.scid},t=$.extend(!0,t,r),room.record.commentguide(t),t.content_=t.content,t.avatar_=t.avatar,t.goldcoin_=t.goldcoin,t.level_=t.level,t.memberid_=t.memberid,t.nickname_=t.nickname,t.iscontrol_=t.iscontrol,t.ytypevt_=t.ytypevt,t.groupName_=t.group_name,t.groupLevel_=t.group_level,view.msgrender(t)}})}))},bind_mobile_phone:function(){function e(e){return/^\d+$/.test(e)}function o(e){var o=/[a-z0-9]/i;return o.test(e)}var t=null;layer.open({type:1,title:!1,closeBtn:0,shade:.3,shadeClose:!0,area:["403px","326px"],skin:"phone",content:template("room/phone/phone",{}),success:function(r,i){$(".cancel").on("click",function(){clearInterval(t),layer.close(i)}),$(".x_close").on("click",function(){clearInterval(t),layer.close(i)});var a=function(e){var o=$("<pre>"+e+"</pre>").css({display:"none"});$("body").append(o);var t=o.width();return o.remove(),t};$("#x_country").on("click",function(){$(".country_list").show(),common.jscroll($(".country_list"))}),$(".list_coun").on("click",function(){$("#x_country").val($(this).attr("data-value")).attr("data-area",$(this).find("span").html()),$("#x_country").width(a($("#x_country").val())),$(".country_list").hide()}),$(".J_img_fresh").trigger("click"),$(".x_get_code").on("click",function(){var r=$(this),i=$("#x_phone_num").val(),a=$("#x_captcha").val(),n=$("#x_country").attr("data-area");clearInterval(t),e(i)?a.length<4||!o(a)?layer.alert("请输入图形验证码"):$.ajax({type:"post",url:"/common/h5api/send_sms",async:!0,data:{mobile:i,method:11,captcha:a,country:n},global:!1,success:function(e){if(1==e.result){layer.alert("验证码已经送,请注意接收短信"),r.addClass("done").html("重新发送(60s)");var o=60;t=setInterval(function(){return 1>o?(clearInterval(t),void r.removeClass("done").html("获取验证码")):(o--,void r.html("重新发送("+o+"s)"))},1e3)}else layer.alert(e.msg)}}):layer.alert("请输入正确的手机号码",function(e){layer.close(e)})}),$(".x_determine").on("click",function(){var o=$("#x_phone_num").val(),r=($("#x_captcha").val(),$("#x_phone_code").val()),i=$("#x_country").attr("data-area");clearInterval(t),$(".x_get_code").removeClass("done").html("获取验证码"),e(o)?$.ajax({url:"/www/live/relate_mobile",type:"post",async:!0,global:!1,data:{mobile:o,checkcode:r,country:i},success:function(e){room.useraction.bind_mobile_success(e)}}):layer.alert("请输入正确的手机号码",function(e){layer.close(e)})})}})},bind_mobile_success:function(e){1==e.result&&(layer.closeAll(),e.msg="绑定成功！"),layer.open({type:1,title:!1,closeBtn:0,shade:.3,time:1==e.result?3e3:null,shadeClose:!0,area:["402px","211px"],skin:"phone",content:template("room/phone/phone_success",e),success:function(e,o){$(".x_close").on("click",function(){layer.close(o)}),$(".close_alg").on("click",function(){layer.close(o)})}})},choosegift:function(e){var o=$(this),t=60,r=4*t,i=$("#J_giftaction .gift_move"),a=$("#J_giftaction .mark>div"),n=($("img",i).length,i.position().left),s=Math.floor($("#J_giftaction .giftlist").width()/t);if(!o.hasClass("x_choosegift")){o.addClass("x_choosegift"),a=Math.max(a.eq(0).width(),a.eq(1).width()),2==$("#J_giftaction .tabon").attr("data-value")&&(a=$("#J_giftaction .itemcard>div").width(),t=100,r=2*t);var s=Math.floor($("#J_giftaction .giftlist").width()/t);if(o.is(".left")){if(o.siblings(".right").removeClass("disable"),n>=0)return void o.addClass("disable");o.removeClass("disable")}else{if(o.siblings(".left").removeClass("disable"),-1*n+s*t>=a)return void o.addClass("disable");o.removeClass("disable"),r=-1*r}var c=n+r;c=c>0?0:c,c=t*s-a>c?t*s-a:c,(0==c||c==t*s-a)&&o.addClass("disable"),i.stop().animate({left:c},400,function(){$("#J_giftaction .window .btn").removeClass("x_choosegift")}),e.preventDefault()}},giftnum:function(){var e=$("#J_giftaction .giftlist .on img");if(!e.length)return this.blur(),layer.alert("请先选择礼物!"),!1;var o=e.attr("data-number");if(!(o.indexOf(",")<0&&e.attr("data-isbursts")))return o=o.split(","),o.reverse(),$(this).after(template("room/gift/gift_number",{list:o})),$(this).focusout(),!1},giftclick:function(){var e=$("#J_giftaction .giftlist .on");e.is(".J_isForbbiden");var o=e.attr("data-giftid"),t=$("#J_gift_num"),r=t.siblings("ul").find("li.on").text()||t.val(),i={};i={scid:room.pro.scid,amount:r,giftid:o,price:parseInt(e.attr("data-goldcoin"))||0,type:e.attr("data-type"),childtype:e.attr("data-childtype"),name:e.attr("data-name"),cover:e.attr("src"),isbursts:e.attr("data-isbursts")||0,x_number:parseInt(4==e.attr("data-type")?$("#x_free_"+o).html():e.attr("data-number")),forbbidenTips:e.attr("data-forbbidenTips")||"礼物太少啦，快去完成每日任务赚取吧～"},room.useraction.sendgift(i)},guard_layer:function(e){layer.open({type:1,title:!1,closeBtn:0,area:["340px","350px"],skin:"x_guard_layer",shade:.1,shadeClose:!0,content:template("room/gift/guard_layer",e),success:function(){$(".x_guard_layer").css({"background-color":"rgba(0,0,0,0.9)"}),$("#guard_countdown").html(room.pro.usermessage.duration+"s"),$(".x_guard_layer .grab_seat").on("click",function(){var o={scid:room.pro.scid,amount:1,giftid:e.chatmsg.giftid,price:e.chatmsg.price||e.giftmsg.price,type:e.chatmsg.type||e.giftmsg.type,childtype:e.chatmsg.childtype||e.giftmsg.childtype,name:e.chatmsg.name||e.giftmsg.name,cover:e.chatmsg.cover||e.giftmsg.cover,isbursts:e.chatmsg.isbursts||e.giftmsg.isbursts};
room.useraction.sendgift(o),layer.closeAll()})}})}},event:{init:function(){this.click(),this.delegate(),this.keyup(),this.extentdRequestAnimationFrame(),this.praise()},userinfocard:function(e,o){$(e).find(".layui-layer-content").css("overflow","visible"),$(".close",e).click(function(){layer.close(o)}),$(".J_setcontrl",e).click(function(){var e=this.innerText.indexOf("取消")>-1,o={};o.url=e?"/member/h5api/cancle_control":"/member/h5api/control_members",o.scid=room.pro.scid;var t=this;e?o.controlid=this.getAttribute("data-memberid"):o.controlids=this.getAttribute("data-memberid"),$.ajax({url:o.url,dataType:"json",data:o}).done(function(o){o&&1==o.result&&(t.innerText=e?"设为场控":"取消场控")})}),$(".J_black",e).click(function(){var e=this;common.afterlogin(function(o){var t=e.innerText.indexOf("取消")>-1,r={};r.url=t?"/member/h5api/cancle_black":"/member/h5api/black_members",r.scid=room.pro.scid,o.memberid!=room.pro.anchor.memberid&&(r.anchorid=room.pro.anchor.memberid),t?r.blackid=e.getAttribute("data-memberid"):r.blackids=e.getAttribute("data-memberid"),$.ajax({url:r.url,dataType:"json",data:r}).done(function(o){o&&1==o.result&&(e.innerText=t?"拉黑":"取消拉黑")})})})},click:function(){$("#J_lock").click(function(){room.pro.locklive=!room.pro.locklive;var e=new Image;e.src="/static/images/icon/1.png?p_from="+(room.pro.locklive?"pRoom.FlashShut":"pRoom.FlashOpen")+"&"+Date.now(),$("#J_cover").toggleClass("hide"),$(this).toggleClass("unlock")}),$("#J_comment").click(room.useraction.comment).focus(function(){this.blur()}),$("#J_send_gift").click(room.useraction.giftclick),$("#J_giftaction .window .btn").click(room.useraction.choosegift),$("#J_gift_form .text").click(room.useraction.giftnum),$(".w400").delegate(".giftpendant .outer_frame","click",function(){room.useraction.guard_layer(room.pro.usermessage.guardgif)})},keyup:function(){$("#J_msgform .text").keyup(function(e){var o=e.which;13==o&&$("#J_comment").trigger("click")})},delegate:function(){var e;$("#J_giftaction").delegate(".giftlist .img","mouseenter",function(){var o={};o.giftid=this.getAttribute("data-giftid"),o.goldcoin=this.getAttribute("data-goldcoin"),o.name=this.getAttribute("data-name"),o.cover=this.getAttribute("src"),o.number=this.getAttribute("data-number"),o.type=this.getAttribute("data-type"),e=layer.tips(template("room/gift/gifthover",o),this,{tips:[3,"#3595CC"],time:3336e3,skin:"layer-pmd5",anim:-1})}).delegate(".giftlist .img","mouseout",function(){layer.close(e)}),$(".w330").delegate(".J_tog_1 li","click",function(){$(this).addClass("on").siblings().removeClass("on").removeClass("x_noble"),$(this).hasClass("x_first")&&$(this).addClass("x_noble");var e=$(this).parent(),o=e.attr("data-tog");e=$(o+">*"),e.hide(),e.eq($(this).index()).show()}),$(".w330").delegate(".x_first","mouseenter",function(){$(this).addClass("on_h")}).delegate(".x_first","mouseleave",function(){$(this).removeClass("on_h")}),$("#J_giftaction").delegate(".giftlist span","click",function(){$("#J_giftaction span").removeClass("on");$("#J_gift_form ul").remove(),$(this).addClass("on"),$("#J_gift_form .text").val("1"),$(this).is(".J_isForbbiden")&&layer.msg($(this).attr("data-forbbidenTips")||"无法赠送此礼物!")}),$("#J_gift_form .text").focus(function(){$(this).blur()}),$("#J_gift_form").delegate("li","click",function(){{var e=$(this);$("#J_gift_form .text").val(e.text())}$("#J_gift_form ul").remove()}),$(document).undelegate(".w400 .follow","click").delegate(".w400 .J_follow","click",function(e){e.stopPropagation(),e.preventDefault();var o=$(this);return common.follow(o.attr("mid"),function(){room.fn.wblog({action:"attend",extend:{ownerid:room.pro.anchor.weibo_openid,yzbid:o.attr("mid")}}),room.useraction.smallwidthvideofollow(o)}),!1}).delegate(".freestar","click",room.useraction.sendstar).delegate("#J_report","click",function(){layer.open({type:1,title:"举报此主播",area:["360px","auto"],content:template("room/loadsec/report",{})});$(".submit button").click(function(){layer.alert("举报成功!",function(){layer.closeAll()})})}),$(".w330").delegate(".his","mouseenter",function(){$(".micro_order").show().bind("mouseleave",function(){$(this).hide()})}),$(".w330").delegate(".his","mouseleave",function(){$(".micro_order").hide()}),$(".w330").delegate(".his .more a","click",function(){$(".micro_order").show()}),$(".w330").delegate(".micro_order_top p","click",function(){$(this).addClass("on1").siblings().removeClass("on1"),"1"==$(this).attr("data-log")?$("#micro_msg1").show().siblings().hide():$("#micro_msg2").show().siblings().hide()}),$(document).delegate(".true_follow2","click",function(){common.afterlogin(common.layerpayment(fans_msgs,"开通"))}).delegate(".true_follow1","click",function(){common.afterlogin(common.layerpayment(fans_msgs,"续费"))}).delegate(".true_follow","click",function(){common.afterlogin(common.layerpayment(fans_msgs,"开通"))})},resizerank:function(){function e(e){n?a.css("height","auto"):(a.height(a.height()).css("min-height","0px"),s.css({height:"auto"}),i=s.height(),n=!0),null==e&&(e=window.event);var c=e.clientY-t;r>i-c||r+42>o+c||(a.css("bottom",i-c+"px"),s.css({top:$("#J_live_box").height()-i+c+5+"px"}))}var o,t,r=50,i=0,a=$("#J_resize"),n="0px"==$("#J_resize").css("min-height"),s=$("#J_gift_his").parent();s.css({top:a.height()+a.position().top+"px",height:"auto"}),$("#J_drag_b").on("mousedown",function(r){r||(r=window.event),o=a.height(),i=parseInt(a.css("bottom")),t=r.clientY,document.onmousemove=e}),document.onmouseup=function(){document.onmousemove=null}},extentdRequestAnimationFrame:function(){"use strict";for(var e=["webkit","moz"],o=0;o<e.length&&!window.requestAnimationFrame;++o){var t=e[o];window.requestAnimationFrame=window[t+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t+"CancelAnimationFrame"]||window[t+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var r=0;window.requestAnimationFrame=function(e){var o=Date.now(),t=Math.max(r+16,o);return setTimeout(function(){e(r=t)},t-o)},window.cancelAnimationFrame=clearTimeout}},praise:function(){function e(e,o){return Math.round(e+Math.random()*(o-e))}function o(){$(".snowfall-canvas").remove(),$(element).children(".snowfall-flakes").remove(),cancelAnimationFrame(n),n=0}function t(){if(i.length<1)return void o();for(var e=0;e<i.length;e+=1)i[e].update();n=requestAnimationFrame(function(){t()})}function r(o){function r(t,r){this.x=19,this.y=30,this.size=t,this.speed=r,this.step=0,this.stepSize=e(1,10)/100;var a=null;a=document.createElement("img"),a.src="/static/images/gif/praise/"+e(0,9)+".png",$(a).attr({"class":"snowfall-flakes"}).css({width:this.size,height:this.size,position:o.flakePosition,bottom:this.y,right:this.x,fontSize:0,zIndex:o.flakeIndex}),$(a).animate({width:20,height:20},500),$(element).get(0).tagName===$(document).get(0).tagName?($("body").append($(a)),element=$("body")):$(element).append($(a)),this.element=a,this.update=function(){this.y+=this.speed,this.y>200&&this.remove(),this.element.style.bottom=this.y+"px",this.element.style.right=this.x+"px",this.step+=this.stepSize,this.x+=.8*Math.cos(this.step)},this.remove=function(){var e=this;$(this.element).fadeOut(1500,function(){$(this).remove();for(var o=0;o<i.length;o++)e==i[o]&&i.splice(o,1)})}}var a={flakeCount:Math.random()>.7?10:1,flakeColor:"#ffffff",flakePosition:"absolute",flakeIndex:999999,minSize:5,maxSize:5,minSpeed:1,maxSpeed:2,round:!1,shadow:!1,deviceorientation:!1},o=$.extend(a,o);i.push(new r(e(100*o.minSize,100*o.maxSize)/100,e(o.minSpeed,o.maxSpeed))),$.ajax({url:room.pro.url.praise,type:"POST",dataType:"json",data:{scid:room.pro.scid,type:0,praises:o.flakeCount},global:!1}).done(function(e){return e&&1==e.result?void room.fn.wblog({action:"like",extend:{ownerid:room.pro.anchor.weibo_openid,yzbid:room.pro.anchor.memberid,like_cnt:o.flakeCount}}):void(600==e.result&&common.layerlogin())});for(var s=1;s<o.flakeCount;s+=1)setTimeout(function(){i.push(new r(e(100*o.minSize,100*o.maxSize)/100,e(o.minSpeed,o.maxSpeed)))},e(50,330));0===n&&t()}var i=[];element=$("#J_w400");var a=0,n=0;$(element).data("snowfall",this),$(element).get(0).tagName===$(document).get(0).tagName&&(a=-25),$("#J_praise").click(r)}},load_client:function(){$("#J_left_bar").remove()},load_lenovo:function(){if($("#J_left_bar").remove(),room.pro.anchor.width<room.pro.anchor.height){var e=$("#J_anchorinfo .his dd a").attr("href");$("#J_anchorinfo .his dd a").removeAttr("target").attr("href",e+"&"+common.versions.len_parameter)}else $("#J_anchor_status .img a").each(function(e,o){var t=$(o).attr("href");$(o).removeAttr("target").attr("href",t+"&"+common.versions.len_parameter)});var o=$("#J_anchorinfo .avatar a").attr("href");$("#J_anchorinfo .avatar a").removeAttr("target").attr("href",o+"&"+common.versions.len_parameter);var t=$("#J_anchorinfo .info a").attr("href");$("#J_anchorinfo .info a").removeAttr("target").attr("href",t+"&"+common.versions.len_parameter),$("#J_live_box").append('<div class="lenovo_goback"><a href="/?'+common.versions.len_parameter+'">返回一直播首页</a></div>'),room.lenovo_login()},lenovo_login:function(){var e=common.checklogin();e&&$("#J_live_box").append('<div class="lenovo_login"><img src="'+e.avatar+'"><div class="nickname"><a href="/member/personel/user_info?memberid='+e.memberid+"&"+common.versions.len_parameter+'">'+e.nickname+"</a></div></div>")},IEVersion:function(){var e=navigator.userAgent,o=e.indexOf("Opera")>-1,t=e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1&&!o,r=e.indexOf("Windows NT 6.1; Trident/7.0;")>-1&&!t;if(t){var i=new RegExp("MSIE (\\d+\\.\\d+);");i.test(e);var a=parseFloat(RegExp.$1);return 7==a?7:8==a?8:9==a?9:10==a?10:11==a?11:0}return r?"Edge":"非IE"}(),init:function(){"number"==typeof room.IEVersion&&room.IEVersion<9&&setTimeout(function(){common.reset.commonalertmsg({msg:"您的浏览器版本过低部分功能暂不支持，请升级到最新浏览器。"})},1e3),this.fn.extendie(),this.fn.ajaxinit();var e=/^\/.*\/([^\/]*)\.html$/;return this.pro.scid=window.location.search.indexOf("fe_debug")>-1?common.pro.querystring.scid:e.exec(window.location.pathname)[1],this.pro.scid?(this.render.init(),this.event.init(),common.jscroll(),common.versions.client&&room.load_client(),void(common.versions.lenovo&&room.load_lenovo())):void layer.alert("url不正确")}};var view=new render,CHAT={socket:null,init:function(e){var o=location.hostname.substr(0,location.hostname.indexOf("."));o+=".","dev."!=o&&(o="");var t=("https:"===location.protocol?"wss":"ws")+"://"+o+"ws.yizhibo.com";common.pro.querystring.ws&&(t=common.pro.querystring.ws),this.socket=io.connect(t,{reconnectionAttemptes:10,reconnectionDelay:3e3,transports:["websocket"],path:"/websocket","force new connection":!0});var r=this;this.socket.on("connect",function(){r.socket.emit("joinRoom",e)}),this.socket.on("disconnect",function(){}),r.socket.on("comment",function(e){view.add(e)}),r.socket.on("gift",function(e){view.gift(e)}),r.socket.on("live_info",function(e){view.live_info(e)}),r.socket.on("praise",function(){}),r.socket.on("login",function(e){view.login(e)}),r.socket.on("message",function(e){view.message(e)}),r.socket.on("queuing_show",function(e){room.load.load_switch_anchor(e)})}};room.init();var XinCHAT={_socket:null,pingheatcount:null,reconnect:null,scid:room.pro.scid,visitor_id:"",errornum:0,init:function(e){"number"==typeof room.IEVersion&&9==room.IEVersion&&view.system_hints();var o=location.hostname.substr(0,location.hostname.indexOf("."));o.indexOf("test")>-1?o="test":o.indexOf("chk")>-1||(o=""),common.pro.querystring.domain&&(o=common.pro.querystring.domain);var t=("https:"===location.protocol?"wss":"ws")+"://"+o+"ws.yizhibo.com/websocket";this._socket=new WebSocket(t);var r=this;this._socket.onopen=function(){clearTimeout(r.reconnect);var o=$.cookie("yxa_did"),t=$.cookie("login_token"),i=common.checklogin(),a=i?$.cookie("yxa_uid"):"",n=i&&t?a:XinCHAT.visitor_id,s={body:'{"did_":"'+o+'","isAnchor_":"0","memberId_":"'+n+'","token_":"'+e+'","scid_":"'+r.scid+'"}',clientVersion:101,cmdId:2,isZip:1};r._socket.send(JSON.stringify(s)),r._socket.polling=setInterval(function(){r.pingheatcount++,r._socket.send("")},2e4)},this._socket.onclose=function(){clearTimeout(r._socket.polling),clearTimeout(r.reconnect),r.reconnect=setTimeout(function(){console.log("长连接关闭重连！"),XinCHAT.getltoken(room.pro.scid)},6e3)},this._socket.onmessage=function(e){if("string"==typeof e.data)r.getmessage(e.data);else{var o=new FileReader;o.readAsArrayBuffer(e.data),o.onload=function(e){function o(e){for(var o="",t=0;t<e.length;t++)o+=String.fromCharCode(e[t]);return decodeURIComponent(escape(o))}if(e.target.readyState==FileReader.DONE)if(window.TextDecoder){var t=new TextDecoder("utf-8").decode(pako.ungzip(e.target.result));r.getmessage(t)}else{var i=pako.ungzip(e.target.result),t=o(i);r.getmessage(t)}}}},this._socket.onerror=function(){clearTimeout(r._socket.polling),clearTimeout(r.reconnect),r.reconnect=setTimeout(function(){console.log("长连接错误重连！"),XinCHAT.getltoken(room.pro.scid)},6e3)}},getmessage:function(e){e=JSON.parse(e);var o=JSON.parse(e.body);switch(o.cmdId=parseInt(e.cmdId),o.cmdId){case 52:view.system_message(o);break;case 200:view.gift(o);break;case 300:view.message(o),300==o.type_&&view.add(o);break;case 310:view.add(o);break;case 600:view.login(o);break;case 601:break;case 15:o.extraH5_&&(o.extra_h5=o.extraH5_),window.Jiframe_h5corner&&Jiframe_h5corner(o.extra_h5);break;case 1101:room.load.load_switch_anchor(o);break;case 1102:view.live_info(o);break;case 1105:}},getltoken:function(e){if(!(this.errornum>20)){this.errornum++;var o=$.cookie("yxa_did"),t=this,r=location.hostname.substr(0,location.hostname.indexOf("."));r.indexOf("testwww")>-1?r="test-":r.indexOf("test")>-1?r="test.":r.indexOf("chk")>-1?r+=".":r="",common.pro.querystring.domain&&(r=common.pro.querystring.domain),$.ajax({url:"//"+r+"app.yizhibo.com/com.yixia.im.accbal.api.ImAccBalService/1.0.0/getWebSocketConnAcces",type:"GET",dataType:"jsonp",jsonp:"callback",data:{_p:'{"_did": "'+o+'","_appid": "23","_pkgname": "h5.yizhibo.live"}',scid:'"'+e+'"'},success:function(o){o&&1e4==o.result?(XinCHAT.visitor_id=$.cookie("visitor_id"),XinCHAT.init(o.data.imToken,e)):t.errornum<20&&setTimeout(function(){layer.closeAll(),console.log("长连接重连关闭所有弹窗"),XinCHAT.getltoken(room.pro.scid)},2e3)}})}}};window.onbeforeunload=function(){room.useraction.logoutLiveRoom()};